<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>拆书系列之《STL源码剖析》序列式容器（sequence containers） | JoyChen's 知识星球</title><meta name="keywords" content="拆书系列,STL"><meta name="author" content="JoyChen"><meta name="copyright" content="JoyChen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="《STL源码剖析》序列式容器（sequence containers）参考自《STL 源码剖析》-侯捷著。     vectorvector 的实现技术，关键在于其对大小的控制和重新配置时到的数据移动效率。   vector 代码摘要（GCC 版本）stl_vector.h 定义的 vector 会调用到 vector.tcc 里的模板方法，基本以如 _M_xxx_xxx_xxx() 命名。 te">
<meta property="og:type" content="article">
<meta property="og:title" content="拆书系列之《STL源码剖析》序列式容器（sequence containers）">
<meta property="og:url" content="http://example.com/2021/06/18/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8%EF%BC%88sequence%20containers%EF%BC%89/index.html">
<meta property="og:site_name" content="JoyChen&#39;s 知识星球">
<meta property="og:description" content="《STL源码剖析》序列式容器（sequence containers）参考自《STL 源码剖析》-侯捷著。     vectorvector 的实现技术，关键在于其对大小的控制和重新配置时到的数据移动效率。   vector 代码摘要（GCC 版本）stl_vector.h 定义的 vector 会调用到 vector.tcc 里的模板方法，基本以如 _M_xxx_xxx_xxx() 命名。 te">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-15.png">
<meta property="article:published_time" content="2021-06-18T13:08:00.000Z">
<meta property="article:modified_time" content="2022-07-10T05:13:59.882Z">
<meta property="article:author" content="JoyChen">
<meta property="article:tag" content="拆书系列">
<meta property="article:tag" content="STL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-15.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/06/18/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8%EF%BC%88sequence%20containers%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '拆书系列之《STL源码剖析》序列式容器（sequence containers）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-10 13:13:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-15.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JoyChen's 知识星球</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">拆书系列之《STL源码剖析》序列式容器（sequence containers）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-18T13:08:00.000Z" title="发表于 2021-06-18 21:08:00">2021-06-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-10T05:13:59.882Z" title="更新于 2022-07-10 13:13:59">2022-07-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C-STL/">C++ STL</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="《STL源码剖析》序列式容器（sequence-containers）"><a href="#《STL源码剖析》序列式容器（sequence-containers）" class="headerlink" title="《STL源码剖析》序列式容器（sequence containers）"></a>《STL源码剖析》序列式容器（sequence containers）</h1><p><code>参考自《STL 源码剖析》-侯捷著。</code></p>
<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8.png">

<h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><p><code>vector 的实现技术，关键在于其对大小的控制和重新配置时到的数据移动效率。</code></p>
<br/>

<h3 id="vector-代码摘要（GCC-版本）"><a href="#vector-代码摘要（GCC-版本）" class="headerlink" title="vector 代码摘要（GCC 版本）"></a>vector 代码摘要（GCC 版本）</h3><p><code>stl_vector.h 定义的 vector 会调用到 vector.tcc 里的模板方法，基本以如 _M_xxx_xxx_xxx() 命名。</code></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span> <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>_Tp<span class="token operator">></span> <span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">vector</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">protected</span> <span class="token class-name">_Vector_base</span><span class="token operator">&lt;</span><span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token class-name">_Alloc</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
 <span class="token keyword">typedef</span> _Tp      value_type<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Base</span><span class="token double-colon punctuation">::</span>pointer                 pointer<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc_traits</span><span class="token double-colon punctuation">::</span>const_pointer  const_pointer<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc_traits</span><span class="token double-colon punctuation">::</span>reference       eference<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc_traits</span><span class="token double-colon punctuation">::</span>const_reference    const_reference<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> __gnu_cxx<span class="token double-colon punctuation">::</span>__normal_iterator<span class="token operator">&lt;</span>pointer<span class="token punctuation">,</span> vector<span class="token operator">></span> iterator<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> __gnu_cxx<span class="token double-colon punctuation">::</span>__normal_iterator<span class="token operator">&lt;</span>const_pointer<span class="token punctuation">,</span> vector<span class="token operator">></span> const_iterator<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>const_iterator<span class="token operator">></span>  const_reverse_iterator<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>iterator<span class="token operator">></span>        reverse_iterator<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> size_t  						size_type<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> ptrdiff_t      		difference_type<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> _Alloc             allocator_type<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<h3 id="vector-的迭代器"><a href="#vector-的迭代器" class="headerlink" title="vector 的迭代器"></a>vector 的迭代器</h3><p>普通指针<strong>具备随机存取</strong>的能力。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Base</span><span class="token double-colon punctuation">::</span>pointer                       pointer<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __gnu_cxx<span class="token double-colon punctuation">::</span>__normal_iterator<span class="token operator">&lt;</span>pointer<span class="token punctuation">,</span> vector<span class="token operator">></span> iterator<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<br/>

<h3 id="vector-的数据结构"><a href="#vector-的数据结构" class="headerlink" title="vector 的数据结构"></a>vector 的数据结构</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">_Vector_base</span> <span class="token punctuation">&#123;</span>
<span class="token comment">//...</span>
<span class="token keyword">struct</span> <span class="token class-name">_Vector_impl_data</span> <span class="token punctuation">&#123;</span>
 pointer _M_start<span class="token punctuation">;</span>     <span class="token comment">// 表示目前使用空间的头</span>
 pointer _M_finish<span class="token punctuation">;</span>    <span class="token comment">// 表示目前使用空间的尾</span>
 pointer _M_end_of_storage<span class="token punctuation">;</span>    <span class="token comment">// 表示目前可用空间的尾</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">_Vector_impl</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">_Tp_alloc_type</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token class-name">_Vector_impl_data</span></span> <span class="token punctuation">&#123;</span>
<span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
 _Vector_impl _M_impl<span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
 <span class="token keyword">void</span> <span class="token function">_M_create_storage</span><span class="token punctuation">(</span>size_t __n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">+</span> __n<span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有了<code>_M_start</code> <code>_M_finish</code> <code>_M_end_of_storage</code>这三个迭代器，可以轻松提供 <code>begin()</code>、 <code>end()</code> 、<code>size()</code> 、<code>capacity()</code>、 <code>empty()</code>、 <code>operator[]</code> 、<code>front()</code>、<code>back()</code>接口。</p>
<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/vector.png">

<br/>

<p><code>关于 STL 中 vector 的成长为什么按两倍成长，可参</code><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/36538542"> 知乎的讨论.</a></p>
<p><code>以及</code><a target="_blank" rel="noopener" href="https://www.drdobbs.com/c-made-easier-how-vectors-grow/184401375">设计者Andrew Koenig 的文章介绍.</a></p>
<br/>

<h3 id="vector-初始化"><a href="#vector-初始化" class="headerlink" title="vector 初始化"></a>vector 初始化</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// Called by the first initialize_dispatch above and by the</span>
<span class="token comment">// vector(n,value,a) constructor.</span>
<span class="token comment">// 填充并予以初始化</span>
<span class="token keyword">void</span> <span class="token function">_M_fill_initialize</span><span class="token punctuation">(</span>size_type __n<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span>
   std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_fill_n_a</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">,</span> __n<span class="token punctuation">,</span> __value<span class="token punctuation">,</span>
                                 <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_ForwardIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Size</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">></span>
<span class="token keyword">inline</span> _ForwardIterator
<span class="token function">uninitialized_fill_n</span><span class="token punctuation">(</span>_ForwardIterator __first<span class="token punctuation">,</span> _Size __n<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_ForwardIterator<span class="token operator">></span><span class="token double-colon punctuation">::</span>value_type
    _ValueType<span class="token punctuation">;</span>
    <span class="token comment">// Trivial types can have deleted assignment, so using std::fill</span>
   <span class="token comment">// would be ill-formed. Require assignability before using std::fill:</span>
   <span class="token keyword">const</span> <span class="token keyword">bool</span> __assignable <span class="token operator">=</span> is_copy_assignable<span class="token operator">&lt;</span>_ValueType<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">;</span>
   <span class="token comment">// 配置后填充</span>
   <span class="token keyword">return</span> <span class="token class-name">__uninitialized_fill_n</span><span class="token operator">&lt;</span><span class="token function">__is_trivial</span><span class="token punctuation">(</span>_ValueType<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> __assignable<span class="token operator">></span><span class="token double-colon punctuation">::</span>
   <span class="token function">__uninit_fill_n</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __n<span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//针对 trivial constructor 的特化版本，调用 std::fill_n</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">__uninitialized_fill_n</span><span class="token operator">&lt;</span><span class="token boolean">true</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_ForwardIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Size</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">></span>
 <span class="token keyword">static</span> _ForwardIterator
 <span class="token function">__uninit_fill_n</span><span class="token punctuation">(</span>_ForwardIterator __first<span class="token punctuation">,</span> _Size __n<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
   <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">fill_n</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __n<span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">//针对 non trivial constructor 的特化版本，调用 ::new</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">bool</span> _TrivialValueType<span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">__uninitialized_fill_n</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_ForwardIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Size</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">></span>
<span class="token keyword">static</span> _ForwardIterator
 <span class="token function">__uninit_fill_n</span><span class="token punctuation">(</span>_ForwardIterator __first<span class="token punctuation">,</span> _Size __n<span class="token punctuation">,</span>
                <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    _ForwardIterator __cur <span class="token operator">=</span> __first<span class="token punctuation">;</span>
     __try <span class="token punctuation">&#123;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> __n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>__n<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">++</span>__cur<span class="token punctuation">)</span>
         std<span class="token double-colon punctuation">::</span><span class="token function">_Construct</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">__addressof</span><span class="token punctuation">(</span><span class="token operator">*</span>__cur<span class="token punctuation">)</span><span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> __cur<span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
     <span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
       __throw_exception_again<span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<h3 id="vector-之-insert"><a href="#vector-之-insert" class="headerlink" title="vector 之 insert()"></a>vector 之 insert()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 还有备用空间</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GROW</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                           __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">++</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span>
  <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 无备用空间</span>
<span class="token keyword">else</span>
    <span class="token function">_M_realloc_insert</span><span class="token punctuation">(</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// _M_realloc_insert</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> _Args<span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span> <span class="token function">_M_realloc_insert</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> _Args<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __args<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
   <span class="token keyword">const</span> size_type __len <span class="token operator">=</span> <span class="token function">_M_check_len</span><span class="token punctuation">(</span><span class="token function">size_type</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"vector::_M_realloc_insert"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pointer __old_start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">;</span>
   pointer __old_finish <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span>
   <span class="token keyword">const</span> size_type __elems_before <span class="token operator">=</span> __position <span class="token operator">-</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pointer <span class="token function">__new_start</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate</span><span class="token punctuation">(</span>__len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   pointer <span class="token function">__new_finish</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
   __try <span class="token punctuation">&#123;</span>
     <span class="token comment">// 配置大小为原来的2倍</span>
     _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>
                              __new_start <span class="token operator">+</span> __elems_before<span class="token punctuation">,</span>
                              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Args<span class="token operator">></span></span></span><span class="token punctuation">(</span>__args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     __new_finish <span class="token operator">=</span> <span class="token function">pointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">if</span> <span class="token function">_GLIBCXX17_CONSTEXPR</span> <span class="token punctuation">(</span><span class="token function">_S_use_relocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       __new_finish <span class="token operator">=</span> <span class="token function">_S_relocate</span><span class="token punctuation">(</span>__old_start<span class="token punctuation">,</span> __position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  __new_start<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token operator">++</span>__new_finish<span class="token punctuation">;</span>

       __new_finish <span class="token operator">=</span> <span class="token function">_S_relocate</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __old_finish<span class="token punctuation">,</span>
                                  __new_finish<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
       <span class="token comment">// 将原来 vector 的内容拷到新的 vector</span>
       <span class="token comment">// std::__uninitialized_move_if_noexcept_a() 最终会调用到</span>
       <span class="token comment">// std::uninitialized_copy()</span>
       __new_finish <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_if_noexcept_a</span> <span class="token punctuation">(</span>__old_start<span class="token punctuation">,</span>                                                        __position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __new_start<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token operator">++</span>__new_finish<span class="token punctuation">;</span>

       __new_finish <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_if_noexcept_a</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                     __old_finish<span class="token punctuation">,</span>  __new_finish<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__new_finish<span class="token punctuation">)</span>
       _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>  __new_start <span class="token operator">+</span> __elems_before<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">else</span>
       std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">,</span> __new_finish<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">_M_deallocate</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">,</span> __len<span class="token punctuation">)</span><span class="token punctuation">;</span>
     __throw_exception_again<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token comment">// 析构并释放原 vector</span>
   <span class="token keyword">if</span> <span class="token function">_GLIBCXX17_CONSTEXPR</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">_S_use_relocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span>__old_start<span class="token punctuation">,</span> __old_finish<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   _GLIBCXX_ASAN_ANNOTATE_REINIT<span class="token punctuation">;</span>
   <span class="token function">_M_deallocate</span><span class="token punctuation">(</span>__old_start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">-</span> __old_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 调整迭代器，指向新的 vector</span>
   <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">=</span> __new_start<span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span> __new_finish<span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">=</span> __new_start <span class="token operator">+</span> __len<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/**
*  @brief  Inserts given rvalue into %vector before specified iterator.
*  @param  __position  A const_iterator into the %vector.
*  @param  __x  Data to be inserted.
*  @return  An iterator that points to the inserted data.
*
*  This function will insert a copy of the given rvalue before
*  the specified location.  Note that this kind of operation
*  could be expensive for a %vector and if it is frequently
*  used the user should consider using std::list.
*/</span>
iterator <span class="token function">insert</span><span class="token punctuation">(</span>const_iterator __position<span class="token punctuation">,</span> value_type<span class="token operator">&amp;&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token function">_M_insert_rval</span><span class="token punctuation">(</span>__position<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">auto</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
    <span class="token function">_M_insert_rval</span><span class="token punctuation">(</span>const_iterator __position<span class="token punctuation">,</span> value_type<span class="token operator">&amp;&amp;</span> __v<span class="token punctuation">)</span> <span class="token operator">-></span> iterator <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token keyword">auto</span> __n <span class="token operator">=</span> __position <span class="token operator">-</span> <span class="token function">cbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>__position <span class="token operator">==</span> <span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GROW</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                   std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">++</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span>
            <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span>
          <span class="token function">_M_insert_aux</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __n<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
        <span class="token function">_M_realloc_insert</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __n<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">+</span> __n<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>


<span class="token comment">/** @file bits/vector.tcc
 *  This is an internal header file, included by other library headers.
 *  Do not attempt to use it directly. @headername&#123;vector&#125;
 */</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">_M_insert_aux</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> <span class="token keyword">bool</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_p <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span><span class="token function">_M_end_addr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">copy_backward</span><span class="token punctuation">(</span>__position<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span> 
                       <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>__position <span class="token operator">=</span> __x<span class="token punctuation">;</span>
    <span class="token operator">++</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> size_type __len <span class="token operator">=</span>
      <span class="token function">_M_check_len</span><span class="token punctuation">(</span><span class="token function">size_type</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"vector&lt;bool>::_M_insert_aux"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _Bit_pointer __q <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate</span><span class="token punctuation">(</span>__len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iterator <span class="token function">__start</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">__addressof</span><span class="token punctuation">(</span><span class="token operator">*</span>__q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iterator __i <span class="token operator">=</span> <span class="token function">_M_copy_aligned</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __position<span class="token punctuation">,</span> __start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>__i<span class="token operator">++</span> <span class="token operator">=</span> __x<span class="token punctuation">;</span>
    iterator __finish <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>__position<span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_deallocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">=</span> __q <span class="token operator">+</span> <span class="token function">_S_nword</span><span class="token punctuation">(</span>__len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">=</span> __start<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span> __finish<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">iterator <span class="token function">insert</span><span class="token punctuation">(</span>const_iterator __position<span class="token punctuation">,</span> initializer_list<span class="token operator">&lt;</span>value_type<span class="token operator">></span> __l<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">auto</span> __offset <span class="token operator">=</span> __position <span class="token operator">-</span> <span class="token function">cbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">_M_range_insert</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __offset<span class="token punctuation">,</span> __l<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __l<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   std<span class="token double-colon punctuation">::</span><span class="token function">random_access_iterator_tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __offset<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_ForwardIterator</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">_M_range_insert</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> 
  _ForwardIterator __first<span class="token punctuation">,</span>                                                           _ForwardIterator __last<span class="token punctuation">,</span>  std<span class="token double-colon punctuation">::</span>forward_iterator_tag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">!=</span> __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">const</span> size_type __n <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">distance</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 备用空间 >= 新增元素个数</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">size_type</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage
                     <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">)</span> <span class="token operator">>=</span> __n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token comment">// 计算插入点之后的现有元素个数</span>
      <span class="token keyword">const</span> size_type __elems_after <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> __position<span class="token punctuation">;</span>
      pointer <span class="token function">__old_finish</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 插入点之后现有的元素个数 > 新增元素个数</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>__elems_after <span class="token operator">></span> __n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GROW</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_a</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">-</span> __n<span class="token punctuation">,</span>
                                    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                    <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">+=</span> __n<span class="token punctuation">;</span> <span class="token comment">// 将 vector 尾端标记后移</span>
        <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_GLIBCXX_MOVE_BACKWARD3</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                __old_finish <span class="token operator">-</span> __n<span class="token punctuation">,</span> __old_finish<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 插入点开始插入新值</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 插入点之后现有的元素个数 &lt;= 新增元素个数</span>
        _ForwardIterator __mid <span class="token operator">=</span> __first<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">advance</span><span class="token punctuation">(</span>__mid<span class="token punctuation">,</span> __elems_after<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GROW</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_copy_a</span><span class="token punctuation">(</span>__mid<span class="token punctuation">,</span> __last<span class="token punctuation">,</span>
                                    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                    <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">+=</span> __n <span class="token operator">-</span> __elems_after<span class="token punctuation">;</span>
        <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span>__n <span class="token operator">-</span> __elems_after<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_a</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    __old_finish<span class="token punctuation">,</span>
                                    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                    <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">+=</span> __elems_after<span class="token punctuation">;</span>
        <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span>__elems_after<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __mid<span class="token punctuation">,</span> __position<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 配置新的 vector 空间</span>
      <span class="token keyword">const</span> size_type __len <span class="token operator">=</span> <span class="token function">_M_check_len</span><span class="token punctuation">(</span>__n<span class="token punctuation">,</span> <span class="token string">"vector::_M_range_insert"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pointer <span class="token function">__new_start</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate</span><span class="token punctuation">(</span>__len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pointer <span class="token function">__new_finish</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
      __try <span class="token punctuation">&#123;</span>
          <span class="token comment">// 1、先将旧 vector 的插入点之前的元素 copy 到新空间</span>
          __new_finish <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_if_noexcept_a</span>
            <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">,</span> __position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             __new_start<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 2、将新增元素 copy 到新空间</span>
          __new_finish <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_copy_a</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span>
                  __new_finish<span class="token punctuation">,</span>
                  <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 3、将旧 vector 的插入点之后的元素 copy 到新空间</span>
          __new_finish <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_if_noexcept_a</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                                                                             <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                              __new_finish<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">,</span> __new_finish<span class="token punctuation">,</span>
            <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">_M_deallocate</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">,</span> __len<span class="token punctuation">)</span><span class="token punctuation">;</span>
          __throw_exception_again<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token comment">// 清除释放旧的 vector</span>
      std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
              <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _GLIBCXX_ASAN_ANNOTATE_REINIT<span class="token punctuation">;</span>
      <span class="token function">_M_deallocate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">,</span>
              <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage
              <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 调整迭代器，指向新的 vector</span>
      <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">=</span> __new_start<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span> __new_finish<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">=</span> __new_start <span class="token operator">+</span> __len<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
 <span class="token function">_M_fill_insert</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> size_type __n<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>__n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 备用空间 >= 新增元素个数</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">size_type</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">)</span> 
     <span class="token operator">>=</span> __n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   _Temporary_value <span class="token function">__tmp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   value_type<span class="token operator">&amp;</span> __x_copy <span class="token operator">=</span> __tmp<span class="token punctuation">.</span><span class="token function">_M_val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> size_type __elems_after <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> __position<span class="token punctuation">;</span>
   pointer <span class="token function">__old_finish</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>__elems_after <span class="token operator">></span> __n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// 插入点之后现有的元素个数 > 新增元素个数</span>
     <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GROW</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
     std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_a</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">-</span> __n<span class="token punctuation">,</span>
                                 <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                 <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                 <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">+=</span> __n<span class="token punctuation">;</span>
     <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">_GLIBCXX_MOVE_BACKWARD3</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                             __old_finish <span class="token operator">-</span> __n<span class="token punctuation">,</span> __old_finish<span class="token punctuation">)</span><span class="token punctuation">;</span>
     std<span class="token double-colon punctuation">::</span><span class="token function">fill</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __n<span class="token punctuation">,</span> __x_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// 插入点之后现有的元素个数 &lt;= 新增元素个数</span>
       <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GROW</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span>
         std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_fill_n_a</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
               __n <span class="token operator">-</span> __elems_after<span class="token punctuation">,</span>
               __x_copy<span class="token punctuation">,</span>
               <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span>__n <span class="token operator">-</span> __elems_after<span class="token punctuation">)</span><span class="token punctuation">;</span>
       std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_a</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __old_finish<span class="token punctuation">,</span>
                 <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                 <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">+=</span> __elems_after<span class="token punctuation">;</span>
       <span class="token function">_GLIBCXX_ASAN_ANNOTATE_GREW</span><span class="token punctuation">(</span>__elems_after<span class="token punctuation">)</span><span class="token punctuation">;</span>
       std<span class="token double-colon punctuation">::</span><span class="token function">fill</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __old_finish<span class="token punctuation">,</span> __x_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">// 配置新的 vector 空间</span>
       <span class="token keyword">const</span> size_type __len <span class="token operator">=</span>
             <span class="token function">_M_check_len</span><span class="token punctuation">(</span>__n<span class="token punctuation">,</span> <span class="token string">"vector::_M_fill_insert"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">const</span> size_type __elems_before <span class="token operator">=</span> __position <span class="token operator">-</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       pointer <span class="token function">__new_start</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate</span><span class="token punctuation">(</span>__len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       pointer <span class="token function">__new_finish</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
       __try <span class="token punctuation">&#123;</span>
       <span class="token comment">// 1、将新增元素以初值为__n, fill 到新空间</span>
       std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_fill_n_a</span><span class="token punctuation">(</span>__new_start <span class="token operator">+</span> __elems_before<span class="token punctuation">,</span>
             __n<span class="token punctuation">,</span> __x<span class="token punctuation">,</span>
             <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       __new_finish <span class="token operator">=</span> <span class="token function">pointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token comment">// 2、将旧 vector 的插入点之前的元素 copy 到新空间</span>
       __new_finish
         <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_if_noexcept_a</span>
         <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">,</span> __position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          __new_start<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       __new_finish <span class="token operator">+=</span> __n<span class="token punctuation">;</span>
                 <span class="token comment">// 3、将旧 vector 的插入点之后的元素 copy 到新空间</span>
       __new_finish <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_move_if_noexcept_a</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                              <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
                                              __new_finish<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">&#125;</span>
       <span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__new_finish<span class="token punctuation">)</span>
         std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span>__new_start <span class="token operator">+</span> __elems_before<span class="token punctuation">,</span>
           __new_start <span class="token operator">+</span> __elems_before <span class="token operator">+</span> __n<span class="token punctuation">,</span>
           <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">else</span>
         std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">,</span> __new_finish<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">_M_deallocate</span><span class="token punctuation">(</span>__new_start<span class="token punctuation">,</span> __len<span class="token punctuation">)</span><span class="token punctuation">;</span>
       __throw_exception_again<span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>

     <span class="token comment">// 清除释放旧的 vector</span>
       std<span class="token double-colon punctuation">::</span><span class="token function">_Destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">,</span>
             <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       _GLIBCXX_ASAN_ANNOTATE_REINIT<span class="token punctuation">;</span>
       <span class="token function">_M_deallocate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">,</span>
             <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// 调整迭代器，指向新的 vector</span>
       <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">=</span> __new_start<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span> __new_finish<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_end_of_storage <span class="token operator">=</span> __new_start <span class="token operator">+</span> __len<span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
 <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/vector-insert.png">

<br/>

<br/>

<h3 id="vector-之-erase"><a href="#vector-之-erase" class="headerlink" title="vector 之 erase()"></a>vector 之 erase()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 清除某个位置的元素</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator
<span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">_M_erase</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>__position <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token function">_GLIBCXX_MOVE3</span><span class="token punctuation">(</span>__position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __position<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">--</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span>
   _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">_GLIBCXX_ASAN_ANNOTATE_SHRINK</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> __position<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 清除 [first, last) 中的所有元素</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator
<span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">_M_erase</span><span class="token punctuation">(</span>iterator __first<span class="token punctuation">,</span> iterator __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">!=</span> __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>__last <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token function">_GLIBCXX_MOVE3</span><span class="token punctuation">(</span>__last<span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __first<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">_M_erase_at_end</span><span class="token punctuation">(</span>__first<span class="token punctuation">.</span><span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> __last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">return</span> __first<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>​    <br/></p>
<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/vector-erase.png">

<br/>

<br/>

<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><h3 id="list-节点"><a href="#list-节点" class="headerlink" title="list 节点"></a>list 节点</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 双向链表</span>
<span class="token comment">/// Common part of a node in the %list.</span>
<span class="token keyword">struct</span> <span class="token class-name">_List_node_base</span> <span class="token punctuation">&#123;</span>
_List_node_base<span class="token operator">*</span> _M_next<span class="token punctuation">;</span>
_List_node_base<span class="token operator">*</span> _M_prev<span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">void</span>
 <span class="token function">swap</span><span class="token punctuation">(</span>_List_node_base<span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> _List_node_base<span class="token operator">&amp;</span> __y<span class="token punctuation">)</span> _GLIBCXX_USE_NOEXCEPT<span class="token punctuation">;</span>

<span class="token keyword">void</span>
 <span class="token function">_M_transfer</span><span class="token punctuation">(</span>_List_node_base<span class="token operator">*</span> <span class="token keyword">const</span> __first<span class="token punctuation">,</span>
             _List_node_base<span class="token operator">*</span> <span class="token keyword">const</span> __last<span class="token punctuation">)</span> _GLIBCXX_USE_NOEXCEPT<span class="token punctuation">;</span>

<span class="token keyword">void</span>
 <span class="token function">_M_reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_USE_NOEXCEPT<span class="token punctuation">;</span>

<span class="token keyword">void</span>
 <span class="token function">_M_hook</span><span class="token punctuation">(</span>_List_node_base<span class="token operator">*</span> <span class="token keyword">const</span> __position<span class="token punctuation">)</span> _GLIBCXX_USE_NOEXCEPT<span class="token punctuation">;</span>

<span class="token keyword">void</span>
 <span class="token function">_M_unhook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_USE_NOEXCEPT<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<h3 id="list-迭代器"><a href="#list-迭代器" class="headerlink" title="list 迭代器"></a>list 迭代器</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">_List_iterator</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">typedef</span> _List_iterator<span class="token operator">&lt;</span>_Tp<span class="token operator">></span>        _Self<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> _List_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span>            _Node<span class="token punctuation">;</span>

 <span class="token keyword">typedef</span> ptrdiff_t                difference_type<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>bidirectional_iterator_tag    iterator_category<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> _Tp                value_type<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> _Tp<span class="token operator">*</span>                pointer<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> _Tp<span class="token operator">&amp;</span>                reference<span class="token punctuation">;</span>

<span class="token function">_List_iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT
<span class="token operator">:</span> <span class="token function">_M_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

<span class="token keyword">explicit</span>
<span class="token function">_List_iterator</span><span class="token punctuation">(</span>__detail<span class="token double-colon punctuation">::</span>_List_node_base<span class="token operator">*</span> __x<span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT
<span class="token operator">:</span> <span class="token function">_M_node</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

 _Self <span class="token function">_M_const_cast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 <span class="token comment">// Must downcast from _List_node_base to _List_node to get to value.</span>
 reference <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Node<span class="token operator">*</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>_M_node<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">_M_valptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 pointer <span class="token keyword">operator</span><span class="token operator">-></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Node<span class="token operator">*</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>_M_node<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">_M_valptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 _Self<span class="token operator">&amp;</span>  <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
    _M_node <span class="token operator">=</span> _M_node<span class="token operator">-></span>_M_next<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 _Self <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
    _Self __tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    _M_node <span class="token operator">=</span> _M_node<span class="token operator">-></span>_M_next<span class="token punctuation">;</span>
    <span class="token keyword">return</span> __tmp<span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 _Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
    _M_node <span class="token operator">=</span> _M_node<span class="token operator">-></span>_M_prev<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 _Self <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
    _Self __tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    _M_node <span class="token operator">=</span> _M_node<span class="token operator">-></span>_M_prev<span class="token punctuation">;</span>
    <span class="token keyword">return</span> __tmp<span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 <span class="token keyword">friend</span> <span class="token keyword">bool</span>
  <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> <span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __y<span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> __x<span class="token punctuation">.</span>_M_node <span class="token operator">==</span> __y<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 <span class="token keyword">friend</span> <span class="token keyword">bool</span>
  <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> <span class="token keyword">const</span> _Self<span class="token operator">&amp;</span> __y<span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> __x<span class="token punctuation">.</span>_M_node <span class="token operator">!=</span> __y<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 <span class="token comment">// The only member points to the %list element.</span>
 __detail<span class="token double-colon punctuation">::</span>_List_node_base<span class="token operator">*</span> _M_node<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="list-数据结构"><a href="#list-数据结构" class="headerlink" title="list 数据结构"></a>list 数据结构</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span> <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>_Tp<span class="token operator">></span> <span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">list</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">protected</span> <span class="token class-name">_List_base</span><span class="token operator">&lt;</span><span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token class-name">_Alloc</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_GLIBCXX_CONCEPT_CHECKS</span></span>
  <span class="token comment">// concept requirements</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token double-colon punctuation">::</span>value_type        _Alloc_value_type<span class="token punctuation">;</span>
 <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">if</span> <span class="token expression">__cplusplus <span class="token operator">&lt;</span> <span class="token number">201103L</span></span></span>
  <span class="token function">__glibcxx_class_requires</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">,</span> _SGIAssignableConcept<span class="token punctuation">)</span>
 <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">endif</span></span>
    <span class="token function">__glibcxx_class_requires2</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">,</span> _Alloc_value_type<span class="token punctuation">,</span> _SameTypeConcept<span class="token punctuation">)</span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">__cplusplus <span class="token operator">>=</span> <span class="token number">201103L</span></span></span>
    <span class="token keyword">static_assert</span><span class="token punctuation">(</span>is_same<span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">remove_cv</span><span class="token operator">&lt;</span>_Tp<span class="token operator">></span><span class="token double-colon punctuation">::</span>type<span class="token punctuation">,</span> _Tp<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span>
                  <span class="token string">"std::list must have a non-const, non-volatile value_type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">ifdef</span> <span class="token expression">__STRICT_ANSI__</span></span>
  <span class="token keyword">static_assert</span><span class="token punctuation">(</span>is_same<span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token double-colon punctuation">::</span>value_type<span class="token punctuation">,</span> _Tp<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span>
                <span class="token string">"std::list must have the same value_type as its allocator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">endif</span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

  <span class="token keyword">typedef</span> _List_base<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span>            _Base<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Base</span><span class="token double-colon punctuation">::</span>_Tp_alloc_type        _Tp_alloc_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Base</span><span class="token double-colon punctuation">::</span>_Tp_alloc_traits        _Tp_alloc_traits<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Base</span><span class="token double-colon punctuation">::</span>_Node_alloc_type        _Node_alloc_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Base</span><span class="token double-colon punctuation">::</span>_Node_alloc_traits    _Node_alloc_traits<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token keyword">typedef</span> _Tp                     value_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp_alloc_traits</span><span class="token double-colon punctuation">::</span>pointer     pointer<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp_alloc_traits</span><span class="token double-colon punctuation">::</span>const_pointer     const_pointer<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp_alloc_traits</span><span class="token double-colon punctuation">::</span>reference     reference<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp_alloc_traits</span><span class="token double-colon punctuation">::</span>const_reference const_reference<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> _List_iterator<span class="token operator">&lt;</span>_Tp<span class="token operator">></span>             iterator<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> _List_const_iterator<span class="token operator">&lt;</span>_Tp<span class="token operator">></span>             const_iterator<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>const_iterator<span class="token operator">></span>     const_reverse_iterator<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>iterator<span class="token operator">></span>         reverse_iterator<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> size_t                     size_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> ptrdiff_t                     difference_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> _Alloc                     allocator_type<span class="token punctuation">;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
  <span class="token comment">// Note that pointers-to-_Node's can be ctor-converted to</span>
  <span class="token comment">// iterator types.</span>
  <span class="token comment">// 环形双向链表，只需要一个指针便可以表示整个链表</span>
  <span class="token keyword">typedef</span> _List_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span>                 _Node<span class="token punctuation">;</span>
 <span class="token comment">// ...</span>

 iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_node<span class="token punctuation">.</span>_M_next<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 _GLIBCXX_NODISCARD <span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_node<span class="token punctuation">.</span>_M_next <span class="token operator">==</span> <span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 const_reference <span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

 reference <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
    iterator __tmp <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">--</span>__tmp<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span>__tmp<span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token comment">// 配置一个节点并传回</span>
 <span class="token keyword">typename</span> <span class="token class-name">_Node_alloc_traits</span><span class="token double-colon punctuation">::</span>pointer <span class="token function">_M_get_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> _Node_alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span>_M_impl<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>
 <span class="token comment">// 产生一个节点，带元素值</span>
 <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> _Args<span class="token operator">></span>
_Node<span class="token operator">*</span> <span class="token function">_M_create_node</span><span class="token punctuation">(</span>_Args<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">auto</span> __p <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_get_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">auto</span><span class="token operator">&amp;</span> __alloc <span class="token operator">=</span> <span class="token function">_M_get_Node_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 __allocated_ptr<span class="token operator">&lt;</span>_Node_alloc_type<span class="token operator">></span> __guard<span class="token punctuation">&#123;</span>__alloc<span class="token punctuation">,</span> __p<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
 _Node_alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span>__alloc<span class="token punctuation">,</span> __p<span class="token operator">-></span><span class="token function">_M_valptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                               std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Args<span class="token operator">></span></span></span><span class="token punctuation">(</span>__args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 __guard <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> __p<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><br/><br/></p>
<p><strong>list 示意图</strong></p>
<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/list%E7%A4%BA%E6%84%8F%E5%9B%BE.png">

<br/>

<br/>

<h3 id="list-之-unique"><a href="#list-之-unique" class="headerlink" title="list 之 unique()"></a>list 之 unique()</h3><p><strong>list 移除 value 相同元素</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>__remove_return_type
<span class="token class-name">list</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  iterator __first <span class="token operator">=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  iterator __l

ast <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 空链表 直接返回</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">==</span> __last<span class="token punctuation">)</span> 
    <span class="token keyword">return</span> <span class="token function">_GLIBCXX20_ONLY</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  size_type __removed <span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__unused__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  iterator __next <span class="token operator">=</span> __first<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>__next <span class="token operator">!=</span> __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>__first <span class="token operator">==</span> <span class="token operator">*</span>__next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">_M_erase</span><span class="token punctuation">(</span>__next<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">_GLIBCXX20_ONLY</span><span class="token punctuation">(</span> __removed<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
      __first <span class="token operator">=</span> __next<span class="token punctuation">;</span>
    __next <span class="token operator">=</span> __first<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token function">_GLIBCXX20_ONLY</span><span class="token punctuation">(</span> __removed <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<h3 id="list-之-erase"><a href="#list-之-erase" class="headerlink" title="list 之 erase()"></a>list 之 erase()</h3><blockquote>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">iterator <span class="token function">erase</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       _List_node_base<span class="token operator">*</span> __next_node <span class="token operator">=</span> __position<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_next<span class="token punctuation">;</span>
       _List_node_base<span class="token operator">*</span> __prev_node <span class="token operator">=</span> __position<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev<span class="token punctuation">;</span>
       _Node<span class="token operator">*</span> __n <span class="token operator">=</span> <span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> __position<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span>
       __prev_node<span class="token operator">-></span>_M_next <span class="token operator">=</span> __next_node<span class="token punctuation">;</span>
       __next_node<span class="token operator">-></span>_M_prev <span class="token operator">=</span> __prev_node<span class="token punctuation">;</span>
       <span class="token function">_Destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>__n<span class="token operator">-></span>_M_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">_M_put_node</span><span class="token punctuation">(</span>__n<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> __next_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/list-erase.png">

<br/>

<br/>

<h3 id="transfer"><a href="#transfer" class="headerlink" title="transfer()"></a>transfer()</h3><p><strong>将 [first, last) 内的所有元素移动到 position 之前</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// SGI STL 版本</span>
<span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> iterator __first<span class="token punctuation">,</span> iterator __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>__position <span class="token operator">!=</span> __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">// Remove [first, last) from its old position.</span>
   __last<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev<span class="token operator">-></span>_M_next     <span class="token operator">=</span> __position<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span>  <span class="token comment">// 1</span>
   __first<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev<span class="token operator">-></span>_M_next    <span class="token operator">=</span> __last<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span>          <span class="token comment">// 2</span>
   __position<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev<span class="token operator">-></span>_M_next <span class="token operator">=</span> __first<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span>     <span class="token comment">// 3</span>

   <span class="token comment">// Splice [first, last) into its new position.</span>
   _List_node_base<span class="token operator">*</span> __tmp      <span class="token operator">=</span> __position<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev<span class="token punctuation">;</span>  <span class="token comment">// 4</span>
   __position<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev <span class="token operator">=</span> __last<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev<span class="token punctuation">;</span>      <span class="token comment">// 5</span>
   __last<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev     <span class="token operator">=</span> __first<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev<span class="token punctuation">;</span>     <span class="token comment">// 6</span>
   __first<span class="token punctuation">.</span>_M_node<span class="token operator">-></span>_M_prev    <span class="token operator">=</span> __tmp<span class="token punctuation">;</span>                                              <span class="token comment">// 7</span>
 <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/list-transfer.png">

<br/>

<h3 id="list-之-splice"><a href="#list-之-splice" class="headerlink" title="list 之 splice()"></a>list 之 splice()</h3><p><strong>transfer() 是非公开接口，STL 为 list 提供了splice()。</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">splice</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> list<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__x<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">transfer</span><span class="token punctuation">(</span>__position<span class="token punctuation">,</span> __x<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __x<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">splice</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> list<span class="token operator">&amp;</span><span class="token punctuation">,</span> iterator __i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  iterator __j <span class="token operator">=</span> __i<span class="token punctuation">;</span>
  <span class="token operator">++</span>__j<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__position <span class="token operator">==</span> __i <span class="token operator">||</span> __position <span class="token operator">==</span> __j<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">transfer</span><span class="token punctuation">(</span>__position<span class="token punctuation">,</span> __i<span class="token punctuation">,</span> __j<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">splice</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">,</span> list<span class="token operator">&amp;</span><span class="token punctuation">,</span> iterator __first<span class="token punctuation">,</span> iterator __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">!=</span> __last<span class="token punctuation">)</span> 
    <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">transfer</span><span class="token punctuation">(</span>__position<span class="token punctuation">,</span> __first<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;list></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> list1 <span class="token punctuation">&#123;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
   std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> list2 <span class="token punctuation">&#123;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

   <span class="token keyword">auto</span> iter <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">find</span><span class="token punctuation">(</span>list1<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list1<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   list1<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>iter<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1, 2, 3, 4, [5, 6, 7, 8, 9] 100</span>
   list1<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//100, 9, 8, 7, 6, 5, 4, 3, 2, 1</span>
   list1<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 1, 2, 3, 4, 5, 6, 7, 8, 9, 100</span>

   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/list-splice.png">

<p><br/><br/></p>
<h3 id="list-之-merge"><a href="#list-之-merge" class="headerlink" title="list 之 merge()"></a>list 之 merge()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">merge</span><span class="token punctuation">(</span>list<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   iterator __first1 <span class="token operator">=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   iterator __last1 <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   iterator __first2 <span class="token operator">=</span> __x<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   iterator __last2 <span class="token operator">=</span> __x<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 两个 list 都已经递增排序</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span>__first1 <span class="token operator">!=</span> __last1 <span class="token operator">&amp;&amp;</span> __first2 <span class="token operator">!=</span> __last2<span class="token punctuation">)</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>__first2 <span class="token operator">&lt;</span> <span class="token operator">*</span>__first1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       iterator __next <span class="token operator">=</span> __first2<span class="token punctuation">;</span>
       <span class="token function">transfer</span><span class="token punctuation">(</span>__first1<span class="token punctuation">,</span> __first2<span class="token punctuation">,</span> <span class="token operator">++</span>__next<span class="token punctuation">)</span><span class="token punctuation">;</span>
       __first2 <span class="token operator">=</span> __next<span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
     <span class="token keyword">else</span>
      <span class="token operator">++</span>__first1<span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>__first2 <span class="token operator">!=</span> __last2<span class="token punctuation">)</span> <span class="token function">transfer</span><span class="token punctuation">(</span>__last1<span class="token punctuation">,</span> __first2<span class="token punctuation">,</span> __last2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="list-之-reverse"><a href="#list-之-reverse" class="headerlink" title="list 之 reverse()"></a>list 之 reverse()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">__List_base_reverse</span><span class="token punctuation">(</span>_List_node_base<span class="token operator">*</span> __p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
_List_node_base<span class="token operator">*</span> __tmp <span class="token operator">=</span> __p<span class="token punctuation">;</span>
   <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
     __STD<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>__tmp<span class="token operator">-></span>_M_next<span class="token punctuation">,</span> __tmp<span class="token operator">-></span>_M_prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
     __tmp <span class="token operator">=</span> __tmp<span class="token operator">-></span>_M_prev<span class="token punctuation">;</span>     <span class="token comment">// Old next node is now prev.</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>__tmp <span class="token operator">!=</span> __p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">__List_base_reverse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="list-之-sort"><a href="#list-之-sort" class="headerlink" title="list 之 sort()"></a>list 之 sort()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// Do nothing if the list has length 0 or 1.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>_M_node<span class="token operator">-></span>_M_next <span class="token operator">!=</span> _M_node <span class="token operator">&amp;&amp;</span> _M_node<span class="token operator">-></span>_M_next<span class="token operator">-></span>_M_next <span class="token operator">!=</span> _M_node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  list<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span> __carry<span class="token punctuation">;</span>
  list<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span> __counter<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> __fill <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    __carry<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>__carry<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> __i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>__i <span class="token operator">&lt;</span> __fill <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>__counter<span class="token punctuation">[</span>__i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      __counter<span class="token punctuation">[</span>__i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>__carry<span class="token punctuation">)</span><span class="token punctuation">;</span>
      __carry<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>__counter<span class="token punctuation">[</span>__i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    __carry<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>__counter<span class="token punctuation">[</span>__i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         
    <span class="token keyword">if</span> <span class="token punctuation">(</span>__i <span class="token operator">==</span> __fill<span class="token punctuation">)</span> <span class="token operator">++</span>__fill<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> 

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> __i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> __i <span class="token operator">&lt;</span> __fill<span class="token punctuation">;</span> <span class="token operator">++</span>__i<span class="token punctuation">)</span>
    __counter<span class="token punctuation">[</span>__i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>__counter<span class="token punctuation">[</span>__i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">swap</span><span class="token punctuation">(</span>__counter<span class="token punctuation">[</span>__fill<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<p><strong>list 使用注意事项</strong></p>
<p><code>由于 list 的迭代器类型是 Bidirectional Iterators, 而 std::sort() 要求的是 RandomAccessIterator, 必须使用自身的 sort() 函数排序，否则会报错：</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/include/c++/9/bits/stl_algo.h: In instantiation of ‘void std::__sort<span class="token punctuation">(</span>_RandomAccessIterator, _RandomAccessIterator, _Compare<span class="token punctuation">)</span> <span class="token punctuation">[</span>with _RandomAccessIterator <span class="token operator">=</span> std::_List_iterator<span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">;</span> _Compare <span class="token operator">=</span> __gnu_cxx::__ops::_Iter_less_iter<span class="token punctuation">]</span>’:
/usr/include/c++/9/bits/stl_algo.h:4867:18:   required from ‘void std::sort<span class="token punctuation">(</span>_RAIter, _RAIter<span class="token punctuation">)</span> <span class="token punctuation">[</span>with _RAIter <span class="token operator">=</span> std::_List_iterator<span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">]</span>’
required from here
/usr/include/c++/9/bits/stl_algo.h:1968:22: error: no match <span class="token keyword">for</span> ‘operator-’ <span class="token punctuation">(</span>operand types are ‘std::_List_iterator<span class="token operator">&lt;</span>int<span class="token operator">></span>’ and ‘std::_List_iterator<span class="token operator">&lt;</span>int<span class="token operator">></span>’<span class="token punctuation">)</span>
<span class="token number">1968</span> <span class="token operator">|</span>     std::__lg<span class="token punctuation">(</span>__last - __first<span class="token punctuation">)</span> * <span class="token number">2</span>,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><br/><br/></p>
<h2 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h2><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/deque.png">

<table>
<thead>
<tr>
<th align="center">deque</th>
<th align="center">vector</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>（支持头尾两端插入删除）双向</strong>、开口</td>
<td align="center"><strong>（头部操作效率极差）单向</strong>、开口</td>
</tr>
<tr>
<td align="center">允许<strong>常数时间</strong>内对起头端进行元素的插入&#x2F;移出</td>
<td align="center">尾端成长</td>
</tr>
<tr>
<td align="center"><strong>没有capacity()</strong> 概念</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">动态地以分段连续空间组合而成、随时增加一段新空间并链接起来</td>
<td align="center">空间不足时，存在 <strong>reallocate()</strong> 新空间，<strong>destroy()</strong> 旧空间</td>
</tr>
<tr>
<td align="center"><strong>没必要提供 reserve()</strong> 功能</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Ramdon Access Iterator 复杂度比 vector 高</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">对 deque 排序，可以先复制到 vector 排序后再 copy 回来</td>
<td align="center"></td>
</tr>
</tbody></table>
<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// map 是一个 T**</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">_Deque_base</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">iterator</span><span class="token double-colon punctuation">::</span>_Map_pointer _Map_pointer<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">_Deque_impl</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">_Tp_alloc_type</span></span> <span class="token punctuation">&#123;</span>
_Map_pointer _M_map<span class="token punctuation">;</span>        <span class="token comment">// 指向 map, 存储 T** 类型的连续空间</span>
size_t _M_map_size<span class="token punctuation">;</span>         <span class="token comment">// buffer 块数</span>
iterator _M_start<span class="token punctuation">;</span>            <span class="token comment">// 指向第一个 buffer</span>
iterator _M_finish<span class="token punctuation">;</span>            <span class="token comment">// 指向最后一个 buffer</span>
<span class="token function">_Deque_impl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token operator">:</span> <span class="token function">_Tp_alloc_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token function">_M_map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token function">_M_map_size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_M_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token function">_M_finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
<span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
_Deque_impl _M_impl<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/deque-map-node-buffer.png">

<br/>

<h3 id="deque-迭代器"><a href="#deque-迭代器" class="headerlink" title="deque 迭代器"></a>deque 迭代器</h3><ul>
<li>能够指出分段连续空间（buffer）的位置</li>
<li>能够判断当前所处的 buffer 的边缘</li>
<li>能够控制 map 跳跃到上一个&#x2F;下一个buffer</li>
</ul>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Ref</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Ptr</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">_Deque_iterator</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 未继承 std::iterator</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">__cplusplus <span class="token operator">&lt;</span> <span class="token number">201103L</span></span></span>
<span class="token keyword">typedef</span> _Deque_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> _Tp<span class="token operator">*</span><span class="token operator">></span>         iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Deque_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">*</span><span class="token operator">></span> const_iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Tp<span class="token operator">*</span>                     _Elt_pointer<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Tp<span class="token operator">*</span><span class="token operator">*</span>                    _Map_pointer<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
<span class="token keyword">private</span><span class="token operator">:</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Up</span><span class="token operator">></span>
<span class="token keyword">using</span> __ptr_to <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">pointer_traits</span><span class="token operator">&lt;</span>_Ptr<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token keyword">template</span> rebind<span class="token operator">&lt;</span>_Up<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_CvTp</span><span class="token operator">></span>
<span class="token keyword">using</span> __iter <span class="token operator">=</span> _Deque_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _CvTp<span class="token operator">&amp;</span><span class="token punctuation">,</span> __ptr_to<span class="token operator">&lt;</span>_CvTp<span class="token operator">>></span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">typedef</span> __iter<span class="token operator">&lt;</span>_Tp<span class="token operator">></span>        iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __iter<span class="token operator">&lt;</span><span class="token keyword">const</span> _Tp<span class="token operator">></span>        const_iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __ptr_to<span class="token operator">&lt;</span>_Tp<span class="token operator">></span>        _Elt_pointer<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> __ptr_to<span class="token operator">&lt;</span>_Elt_pointer<span class="token operator">></span>    _Map_pointer<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">/**
   *  @brief This function controls the size of memory nodes.
   *  @param  __size  The size of an element.
   *  @return   The number (not byte size) of elements per node.
   */</span>
  <span class="token comment">// 决定 buffer 大小的函数</span>
  <span class="token comment">// buffer size 默认值 _GLIBCXX_DEQUE_BUF_SIZE 512</span>
  <span class="token comment">// 如果元素大小 __size &lt; 512 传回 512/__size; 否则传回 1</span>
  _GLIBCXX_CONSTEXPR <span class="token keyword">inline</span> size_t <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span>size_t __size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token punctuation">(</span>__size <span class="token operator">&lt;</span> _GLIBCXX_DEQUE_BUF_SIZE
        <span class="token operator">?</span> <span class="token function">size_t</span><span class="token punctuation">(</span>_GLIBCXX_DEQUE_BUF_SIZE <span class="token operator">/</span> __size<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">size_t</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">static</span> size_t <span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 未继承 std::iterator 所以必须自行撰写5个必要的迭代器相应类型</span>
  <span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>random_access_iterator_tag    iterator_category<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> _Tp                value_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> _Ptr                pointer<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> _Ref                reference<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> size_t                size_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> ptrdiff_t                difference_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> _Deque_iterator            _Self<span class="token punctuation">;</span>

  _Elt_pointer _M_cur<span class="token punctuation">;</span>    <span class="token comment">// 指向某个 buffer 的当前元素</span>
  _Elt_pointer _M_first<span class="token punctuation">;</span>  <span class="token comment">// 指向某个 buffer 的头</span>
  _Elt_pointer _M_last<span class="token punctuation">;</span>   <span class="token comment">// 指向某个 buffer 的尾（含备用空间）</span>
  _Map_pointer _M_node<span class="token punctuation">;</span>   <span class="token comment">// 指向管控中心</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<p><strong>deque 迭代器关键行为</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 一旦遇到 buffer 边缘，就要调用 _M_set_node</span>
<span class="token comment">// 跳一个 buffer</span>
<span class="token keyword">void</span> <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_Map_pointer __new_node<span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
_M_node <span class="token operator">=</span> __new_node<span class="token punctuation">;</span>
_M_first <span class="token operator">=</span> <span class="token operator">*</span>__new_node<span class="token punctuation">;</span>
_M_last <span class="token operator">=</span> _M_first <span class="token operator">+</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
<span class="token operator">++</span>_M_cur<span class="token punctuation">;</span>                                      <span class="token comment">// 切到下一个元素</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>_M_cur <span class="token operator">==</span> _M_last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 如果到达 buffer 尾端</span>
 <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 切到下一个节点（即下一块 buffer）</span>
 _M_cur <span class="token operator">=</span> _M_first<span class="token punctuation">;</span>                <span class="token comment">// 的第一个元素</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>_M_cur <span class="token operator">==</span> _M_first<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 如果到达 buffer 头端</span>
 <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 切到上一个节点（即上一块 buffer）</span>
 _M_cur <span class="token operator">=</span> _M_last<span class="token punctuation">;</span>                    <span class="token comment">// 的最后一个元素</span>
<span class="token punctuation">&#125;</span>
<span class="token operator">--</span>_M_cur<span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 随机存取 迭代器可以直接跳跃 n 个距离</span>
_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span>difference_type __n<span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
<span class="token keyword">const</span> difference_type __offset <span class="token operator">=</span> __n <span class="token operator">+</span> <span class="token punctuation">(</span>_M_cur <span class="token operator">-</span> _M_first<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 目标位置在 同一个 buffer 内</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>__offset <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> __offset <span class="token operator">&lt;</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 _M_cur <span class="token operator">+=</span> __n<span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 目标位置不在 同一个 buffer 内</span>
 <span class="token keyword">const</span> difference_type __node_offset <span class="token operator">=</span>
   __offset <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> __offset <span class="token operator">/</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token operator">:</span> <span class="token operator">-</span><span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>__offset <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                      <span class="token operator">/</span> <span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token comment">// 切换到正确的 buffer</span>
 <span class="token function">_M_set_node</span><span class="token punctuation">(</span>_M_node <span class="token operator">+</span> __node_offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 切换正确的元素</span>
 _M_cur <span class="token operator">=</span> _M_first <span class="token operator">+</span> <span class="token punctuation">(</span>__offset <span class="token operator">-</span> __node_offset
                         <span class="token operator">*</span> <span class="token function">difference_type</span><span class="token punctuation">(</span><span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 利用 operator+=</span>
_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">-=</span><span class="token punctuation">(</span>difference_type __n<span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">+=</span> <span class="token operator">-</span>__n<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img title="deque 中控器、缓存区、迭代器的关系" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/deque-map-buffer-iterator.png">

<br/>

<h3 id="deque-创建"><a href="#deque-创建" class="headerlink" title="deque 创建"></a>deque 创建</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/**
*  @brief  Creates a %deque with copies of an exemplar element.
*  @param  __n  The number of elements to initially create.
*  @param  __value  An element to copy.
*  @param  __a  An allocator.
*
*  This constructor fills the %deque with @a __n copies of @a __value.
*/</span>
<span class="token function">deque</span><span class="token punctuation">(</span>size_type __n<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __value<span class="token punctuation">,</span>
      <span class="token keyword">const</span> allocator_type<span class="token operator">&amp;</span> __a <span class="token operator">=</span> <span class="token function">allocator_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">:</span> <span class="token function">_Base</span><span class="token punctuation">(</span>__a<span class="token punctuation">,</span> <span class="token function">_S_check_init_len</span><span class="token punctuation">(</span>__n<span class="token punctuation">,</span> __a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token function">_M_fill_initialize</span><span class="token punctuation">(</span>__value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token function">_Deque_base</span><span class="token punctuation">(</span><span class="token keyword">const</span> allocator_type<span class="token operator">&amp;</span> __a<span class="token punctuation">,</span> size_t __num_elements<span class="token punctuation">)</span>
  <span class="token operator">:</span> <span class="token function">_M_impl</span><span class="token punctuation">(</span>__a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token function">_M_initialize_map</span><span class="token punctuation">(</span>__num_elements<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span> <span class="token function">_M_fill_initialize</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
_Map_pointer __cur<span class="token punctuation">;</span>
__try <span class="token punctuation">&#123;</span>
 <span class="token comment">// 为每个节点的 buffer 设定初值</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span>__cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span>
      __cur <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span>
      <span class="token operator">++</span>__cur<span class="token punctuation">)</span>
   std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_fill_a</span><span class="token punctuation">(</span><span class="token operator">*</span>__cur<span class="token punctuation">,</span> <span class="token operator">*</span>__cur <span class="token operator">+</span> <span class="token function">_S_buffer_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                               __value<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 最后节点的设定稍有不同，考虑尾端可能有备用空间，不必设初值</span>
 std<span class="token double-colon punctuation">::</span><span class="token function">__uninitialized_fill_a</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">,</span>
                             <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span>
                             __value<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<p><strong>_M_create_nodes()</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span>
<span class="token class-name">_Deque_base</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">_M_create_nodes</span><span class="token punctuation">(</span>_Map_pointer __nstart<span class="token punctuation">,</span> _Map_pointer __nfinish<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
_Map_pointer __cur<span class="token punctuation">;</span>
__try <span class="token punctuation">&#123;</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span>__cur <span class="token operator">=</span> __nstart<span class="token punctuation">;</span> __cur <span class="token operator">&lt;</span> __nfinish<span class="token punctuation">;</span> <span class="token operator">++</span>__cur<span class="token punctuation">)</span>
   <span class="token operator">*</span>__cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

_Ptr <span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">typedef</span> __gnu_cxx<span class="token double-colon punctuation">::</span>__alloc_traits<span class="token operator">&lt;</span>_Tp_alloc_type<span class="token operator">></span> _Traits<span class="token punctuation">;</span>
<span class="token keyword">return</span> _Traits<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span>_M_impl<span class="token punctuation">,</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 决定 buffer 大小的函数</span>
<span class="token comment">// buffer size 默认值 _GLIBCXX_DEQUE_BUF_SIZE 512</span>
<span class="token comment">// 如果元素大小 __size &lt; 512 传回 512/__size; 否则传回 1</span>
_GLIBCXX_CONSTEXPR <span class="token keyword">inline</span> size_t <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span>size_t __size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> <span class="token punctuation">(</span>__size <span class="token operator">&lt;</span> _GLIBCXX_DEQUE_BUF_SIZE
       <span class="token operator">?</span> <span class="token function">size_t</span><span class="token punctuation">(</span>_GLIBCXX_DEQUE_BUF_SIZE <span class="token operator">/</span> __size<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">size_t</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<p><strong>_M_initialize_map()</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/**
*  @brief Layout storage.
*  @param  __num_elements  The count of T's for which to allocate space
*                          at first.
*  @return   Nothing.
*  The initial underlying memory layout is a bit complicated...
*/</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">_Deque_base</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span> <span class="token function">_M_initialize_map</span><span class="token punctuation">(</span>size_t __num_elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 需要 map_pointer 节点数 = （元素个数 / 每个缓冲区可容纳的元素个数）+ 1</span>
  <span class="token comment">// 因为 deque::end() 返回的是 finish 迭代器，所以分配多一个节点</span>
  <span class="token keyword">const</span> size_t __num_nodes <span class="token operator">=</span> <span class="token punctuation">(</span>__num_elements <span class="token operator">/</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span>
                              <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 一个中控器需要管理几个节点，</span>
  <span class="token comment">// 至少： _S_initial_map_size = 8 个</span>
  <span class="token comment">// 最多： 所需 map_pointer 节点数 + 2（前后各自预备一个，方便扩充）</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">(</span>size_t<span class="token punctuation">)</span> _S_initial_map_size<span class="token punctuation">,</span>
                                       <span class="token function">size_t</span><span class="token punctuation">(</span>__num_nodes <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map <span class="token operator">=</span> <span class="token function">_M_allocate_map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 以上就配置出了 一个 具有 _M_map_size 个节点的中控器</span>


  <span class="token comment">// 令 nstart 和 nfinish 指向 map 所拥有全部节点的最中央区段</span>
  <span class="token comment">// 保持最中央可以保证 deque 两端生长的能力一样大</span>
  _Map_pointer __nstart <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map
                           <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size <span class="token operator">-</span> __num_nodes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _Map_pointer __nfinish <span class="token operator">=</span> __nstart <span class="token operator">+</span> __num_nodes<span class="token punctuation">;</span>

  __try <span class="token punctuation">&#123;</span>
    <span class="token function">_M_create_nodes</span><span class="token punctuation">(</span>__nstart<span class="token punctuation">,</span> __nfinish<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">&#125;</span>
  <span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 为 deque 内的两个迭代器 start 和 finish 设定正确的内容</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__nstart<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__nfinish <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> _M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">;</span>
  <span class="token comment">// 因为刚好整除会多配置一个节点，</span>
  <span class="token comment">// 此时，cur 指向这个多配置的一个节点</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_first
                                    <span class="token operator">+</span> __num_elements
                                    <span class="token operator">%</span> <span class="token function">__deque_buf_size</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>_Tp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<p><strong>std::deque<int> ideq(512, 1)</strong></p>
<p><code>int 类型的 deque 决定了 __deque_buf_size（一块 buffer 的大小）为 512 / sizeof(int) = 128</code>。</p>
<p><code>512 个元素决定了中控器需要 __num_nodes（buffer 块数）为 (512 / 128) + 1) = 5</code>。</p>
<p><code>中控器大小 _M_map_size 为 std::max(8, (buffer 个数 + 2)) = 8</code>。</p>
<br/>

<img title="deque 构造示例" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/deque-construct.png">

<br/>

<h3 id="deque-之-push-back"><a href="#deque-之-push-back" class="headerlink" title="deque 之 push_back()"></a>deque 之 push_back()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 最后 buffer 还有2个及以上的元素备用空间</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>
                          <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token operator">++</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
 <span class="token function">_M_push_back_aux</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最后 buffer 只剩1个元素备用空间</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> _Args<span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">_M_push_back_aux</span><span class="token punctuation">(</span>_Args<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">max_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token function">__throw_length_error</span><span class="token punctuation">(</span>
 <span class="token function">__N</span><span class="token punctuation">(</span><span class="token string">"cannot create std::deque larger than max_size()"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">_M_reserve_map_at_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 如果中控器后端节点不足，必须重换一个 map</span>
<span class="token comment">// 配置一个新的节点（新 buffer 块）</span>
<span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
__try <span class="token punctuation">&#123;</span>
 <span class="token comment">// 针对标的元素设值</span>
 _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>
                          <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span>
                          std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Args<span class="token operator">></span></span></span><span class="token punctuation">(</span>__args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 改变 finish，指向新节点（新 buffer 块）</span>
 <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 设定 finish 状态</span>
 <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 中控器后端节点不足，重新分配中控器空间</span>
<span class="token keyword">void</span> <span class="token function">_M_reserve_map_at_back</span><span class="token punctuation">(</span>size_type __nodes_to_add <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>__nodes_to_add <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">></span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size
      <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">_M_reallocate_map</span><span class="token punctuation">(</span>__nodes_to_add<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img title="push_back" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/deque-push-back.png">

<br/>

<h3 id="deque-之-pop-back"><a href="#deque-之-pop-back" class="headerlink" title="deque 之 pop_back()"></a>deque 之 pop_back()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
<span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 最后一个 buffer 有一个或者更多的元素</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur
   <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token operator">--</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span>				<span class="token comment">// 调整 finish.cur 指针</span>
 <span class="token comment">// 析构最后一个元素</span>
 _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 最后一个 buffer 没有任何元素</span>
<span class="token keyword">else</span>
 <span class="token function">_M_pop_back_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放 buffer 操作</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 当 finish 指向的 buffer 没有任何一个元素时调用</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">_M_pop_back_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 释放最后一个 buffer</span>
<span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调整 finish 指向上一个 buffer</span>
<span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 找到 buffer（原来倒数第二个 buffer 块） 的最后一个元素</span>
<span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// 析构元素</span>
_Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="deque-之-push-front"><a href="#deque-之-push-front" class="headerlink" title="deque 之 push_front()"></a>deque 之 push_front()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">push_front</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 第一个 buffer 有元素备用空间</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
_Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>
                       <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>
                       __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">--</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span>	<span class="token comment">// 调整 第一块 buffer 使用状态</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
<span class="token function">_M_push_front_aux</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 第一个 buffer 已无元素备用空间</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> _Args<span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">_M_push_front_aux</span><span class="token punctuation">(</span>_Args<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">max_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">__throw_length_error</span><span class="token punctuation">(</span>
<span class="token function">__N</span><span class="token punctuation">(</span><span class="token string">"cannot create std::deque larger than max_size()"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">_M_reserve_map_at_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 如果中控器前端节点不足，重新分配中控器空间</span>
<span class="token comment">// 配置一个新的节点（新 buffer 块）</span>
<span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
__try <span class="token punctuation">&#123;</span>
<span class="token comment">// 改变 start 指向新的 buffer 块</span>
<span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node
                                       <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// start 的 cur 指向 新插入元素</span>
    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 设定新插入元素的值</span>
    _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>
                             <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">,</span>
                             std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Args<span class="token operator">></span></span></span><span class="token punctuation">(</span>__args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 中控器前端节点不足，重新分配中控器空间</span>
<span class="token keyword">void</span> <span class="token function">_M_reserve_map_at_front</span><span class="token punctuation">(</span>size_type __nodes_to_add <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__nodes_to_add <span class="token operator">></span> <span class="token function">size_type</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node
                                 <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">_M_reallocate_map</span><span class="token punctuation">(</span>__nodes_to_add<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img title="push_front" src ="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/deque-push-front.png">

<br/>

<h3 id="deque-之-pop-front"><a href="#deque-之-pop-front" class="headerlink" title="deque 之 pop_front()"></a>deque 之 pop_front()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span>
<span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第一个 buffer 有超过1个元素</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur
   <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 _Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token operator">++</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 第一个 buffer 仅有一个元素，涉及 buffer 释放 </span>
<span class="token keyword">else</span>
 <span class="token function">_M_pop_front_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 当第一个 buffer 仅有一个元素时，会调用</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">_M_pop_front_aux</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 将第一个 buffer 仅剩的唯一一个元素析构</span>
_Alloc_traits<span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 释放第一个 buffer</span>
<span class="token function">_M_deallocate_node</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调整 迭代器 start 的状态指向原来第2个 buffer 块</span>
<span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//</span>
<span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_first<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="重新配置中控器"><a href="#重新配置中控器" class="headerlink" title="重新配置中控器"></a>重新配置中控器</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">void</span>
<span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">_M_reallocate_map</span><span class="token punctuation">(</span>size_type __nodes_to_add<span class="token punctuation">,</span> <span class="token keyword">bool</span> __add_at_front<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">const</span> size_type __old_num_nodes
 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> size_type __new_num_nodes <span class="token operator">=</span> __old_num_nodes <span class="token operator">+</span> __nodes_to_add<span class="token punctuation">;</span>

_Map_pointer __new_nstart<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">*</span> __new_num_nodes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 __new_nstart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size
                                           <span class="token operator">-</span> __new_num_nodes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
      <span class="token operator">+</span> <span class="token punctuation">(</span>__add_at_front <span class="token operator">?</span> __nodes_to_add <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>__new_nstart <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span>
      std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                __new_nstart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      std<span class="token double-colon punctuation">::</span><span class="token function">copy_backward</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span>
                         <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                         __new_nstart <span class="token operator">+</span> __old_num_nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    size_type __new_map_size <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size
      <span class="token operator">+</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size<span class="token punctuation">,</span>
                 __nodes_to_add<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">// 配置一块新的空间， 准备给新的 map （中控器）使用</span>
    _Map_pointer __new_map <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_allocate_map</span><span class="token punctuation">(</span>__new_map_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    __new_nstart <span class="token operator">=</span> __new_map <span class="token operator">+</span> <span class="token punctuation">(</span>__new_map_size <span class="token operator">-</span> __new_num_nodes<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
      <span class="token operator">+</span> <span class="token punctuation">(</span>__add_at_front <span class="token operator">?</span> __nodes_to_add <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 拷贝原 中控器 内容</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span>
              <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
              __new_nstart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 释放原 map（中控器）</span>
    <span class="token function">_M_deallocate_map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 新 map （中控器）的起始地址和大小</span>
    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map <span class="token operator">=</span> __new_map<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_map_size <span class="token operator">=</span> __new_map_size<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// 重新设置 start、finish 迭代器</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__new_nstart<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span><span class="token function">_M_set_node</span><span class="token punctuation">(</span>__new_nstart <span class="token operator">+</span> __old_num_nodes <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="deque-之-insert"><a href="#deque-之-insert" class="headerlink" title="deque 之 insert()"></a>deque 之 insert()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator
<span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">insert</span><span class="token punctuation">(</span>const_iterator __position<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 如果插入点是 deque 的最前端</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>__position<span class="token punctuation">.</span>_M_cur <span class="token operator">==</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 交给 push_front() 做</span>
 <span class="token function">push_front</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 如果插入点是 deque 的最尾端</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>__position<span class="token punctuation">.</span>_M_cur <span class="token operator">==</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_cur<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 交给 push_back() 做</span>
 <span class="token function">push_back</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>
 iterator __tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span>
 <span class="token operator">--</span>__tmp<span class="token punctuation">;</span>
 <span class="token keyword">return</span> __tmp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
 <span class="token keyword">return</span> <span class="token function">_M_insert_aux</span><span class="token punctuation">(</span>__position<span class="token punctuation">.</span><span class="token function">_M_const_cast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> _Args<span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator
<span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">_M_insert_aux</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">,</span> _Args<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 value_type <span class="token function">__x_copy</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Args<span class="token operator">></span></span></span><span class="token punctuation">(</span>__args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 插入点之前的元素个数</span>
 difference_type __index <span class="token operator">=</span> __pos <span class="token operator">-</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">;</span>
 <span class="token comment">//如果插入点之前的元素较少</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">></span></span></span><span class="token punctuation">(</span>__index<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//  push_front 进行一个前端元素的添加</span>
   <span class="token function">push_front</span><span class="token punctuation">(</span><span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   iterator __front1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">;</span>
   <span class="token operator">++</span>__front1<span class="token punctuation">;</span>
   iterator __front2 <span class="token operator">=</span> __front1<span class="token punctuation">;</span>
   <span class="token operator">++</span>__front2<span class="token punctuation">;</span>
   __pos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">+</span> __index<span class="token punctuation">;</span>
   iterator __pos1 <span class="token operator">=</span> __pos<span class="token punctuation">;</span>
   <span class="token operator">++</span>__pos1<span class="token punctuation">;</span>
   <span class="token comment">// 将插入点之前的元素前移，腾出1个元素空间</span>
   <span class="token function">_GLIBCXX_MOVE3</span><span class="token punctuation">(</span>__front2<span class="token punctuation">,</span> __pos1<span class="token punctuation">,</span> __front1<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//  push_back 进行一个后端元素的添加</span>
   <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   iterator __back1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">;</span>
   <span class="token operator">--</span>__back1<span class="token punctuation">;</span>
   iterator __back2 <span class="token operator">=</span> __back1<span class="token punctuation">;</span>
   <span class="token operator">--</span>__back2<span class="token punctuation">;</span>
   __pos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">+</span> __index<span class="token punctuation">;</span>
   <span class="token comment">// 将插入点后面的元素再往后移，腾出1个元素空间</span>
   <span class="token function">_GLIBCXX_MOVE_BACKWARD3</span><span class="token punctuation">(</span>__pos<span class="token punctuation">,</span> __back2<span class="token punctuation">,</span> __back1<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token comment">// 插入点设置新值</span>
 <span class="token operator">*</span>__pos <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__x_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> __pos<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="deque-之-erase"><a href="#deque-之-erase" class="headerlink" title="deque 之 erase()"></a>deque 之 erase()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 按个擦除</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator
<span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">_M_erase</span><span class="token punctuation">(</span>iterator __position<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
iterator __next <span class="token operator">=</span> __position<span class="token punctuation">;</span>
<span class="token operator">++</span>__next<span class="token punctuation">;</span>
<span class="token comment">// 擦除点之前的元素个数</span>
<span class="token keyword">const</span> difference_type __index <span class="token operator">=</span> __position <span class="token operator">-</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果擦除点之前的元素个数较少</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">></span></span></span><span class="token punctuation">(</span>__index<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 前移擦除点之前的元素，只有调用 pop_front()</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>__position <span class="token operator">!=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token function">_GLIBCXX_MOVE_BACKWARD3</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __position<span class="token punctuation">,</span> __next<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 擦除点之后的元素个数较少</span>
 <span class="token comment">// 前移擦除点之后的元素，只有调用 pop_back()</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>__next <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token function">_GLIBCXX_MOVE3</span><span class="token punctuation">(</span>__next<span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __position<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">return</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __index<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 按区间擦除</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">typename</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator
<span class="token class-name">deque</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>
<span class="token function">_M_erase</span><span class="token punctuation">(</span>iterator __first<span class="token punctuation">,</span> iterator __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">==</span> __last<span class="token punctuation">)</span>
 <span class="token keyword">return</span> __first<span class="token punctuation">;</span>
<span class="token comment">// 擦除区间是真个 deque</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">==</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> __last <span class="token operator">==</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 计算擦除区间长度</span>
 <span class="token keyword">const</span> difference_type __n <span class="token operator">=</span> __last <span class="token operator">-</span> __first<span class="token punctuation">;</span>
 <span class="token keyword">const</span> difference_type __elems_before <span class="token operator">=</span> __first <span class="token operator">-</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 如果要擦除区间前面的元素较少</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">></span></span></span><span class="token punctuation">(</span>__elems_before<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> __n<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">// 后移前方的元素</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">!=</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token function">_GLIBCXX_MOVE_BACKWARD3</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __first<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 析构 冗余的元素</span>
   <span class="token function">_M_erase_at_begin</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __n<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">// 前移后方的元素</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>__last <span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token function">_GLIBCXX_MOVE3</span><span class="token punctuation">(</span>__last<span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __first<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 析构 冗余的元素</span>
   <span class="token function">_M_erase_at_end</span><span class="token punctuation">(</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> __n<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token keyword">return</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> __elems_before<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 将冗余的 buffer 释放</span>
<span class="token keyword">void</span> <span class="token function">_M_erase_at_begin</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token function">_M_destroy_data</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __pos<span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">_M_destroy_nodes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start<span class="token punctuation">.</span>_M_node<span class="token punctuation">,</span> __pos<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_start <span class="token operator">=</span> __pos<span class="token punctuation">;</span> <span class="token comment">// 设置 deque 新起点</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 将冗余的 buffer 释放</span>
<span class="token keyword">void</span> <span class="token function">_M_erase_at_end</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token function">_M_destroy_data</span><span class="token punctuation">(</span>__pos<span class="token punctuation">,</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_M_get_Tp_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">_M_destroy_nodes</span><span class="token punctuation">(</span>__pos<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish<span class="token punctuation">.</span>_M_node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token operator">-></span>_M_impl<span class="token punctuation">.</span>_M_finish <span class="token operator">=</span> __pos<span class="token punctuation">;</span> <span class="token comment">// 设置 deque 新尾点</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="deque-之-clear"><a href="#deque-之-clear" class="headerlink" title="deque 之 clear()"></a>deque 之 clear()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> _GLIBCXX_NOEXCEPT <span class="token punctuation">&#123;</span> 
<span class="token function">_M_erase_at_end</span><span class="token punctuation">(</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<br/>

<h2 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h2><p><code>属于 container adaptor，可以指定其他支持 back()、push_back()、pop_back() 接口的容器作为 stack 的内部结构，如：std::stack&lt;int, std::list&lt;int&gt;&gt; linkedStack 。</code></p>
<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/stack.png">

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*   
*  This is not a true container, but an @e adaptor.  It holds
   *  another container, and provides a wrapper interface to that
   *  container.  The wrapper is what enforces strict
   *  first-in-last-out %stack behavior.
   *
   *  The second template parameter defines the type of the underlying
   *  sequence/container.  It defaults to std::deque, but it can be
   *  any type that supports @c back, @c push_back, and @c pop_back,
   *  such as std::list, std::vector, or an appropriate user-defined
   *  type.
*/</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span> <span class="token operator">=</span> deque<span class="token operator">&lt;</span>_Tp<span class="token operator">></span> <span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">stack</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>value_type		value_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>reference		reference<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>const_reference	const_reference<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>size_type		size_type<span class="token punctuation">;</span>
  <span class="token keyword">typedef</span>	       _Sequence			container_type<span class="token punctuation">;</span>
  _GLIBCXX_NODISCARD <span class="token keyword">bool</span>
    <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
  <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

  size_type <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
  <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

  reference <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  const_reference <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
    <span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> _Args<span class="token operator">></span>
  <span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token punctuation">)</span> <span class="token function">emplace</span><span class="token punctuation">(</span>_Args<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Args<span class="token operator">></span></span></span><span class="token punctuation">(</span>__args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Seq</span><span class="token operator">></span>
  <span class="token keyword">inline</span> <span class="token keyword">bool</span>
  <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> stack<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> <span class="token keyword">const</span> stack<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __y<span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> __x<span class="token punctuation">.</span>c <span class="token operator">==</span> __y<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

  <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Seq</span><span class="token operator">></span>
  <span class="token keyword">inline</span> <span class="token keyword">bool</span>
  <span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> stack<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> <span class="token keyword">const</span> stack<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __y<span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> __x<span class="token punctuation">.</span>c <span class="token operator">&lt;</span> __y<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

  <span class="token comment">// ...</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
  <span class="token comment">//  See queue::c for notes on this name.</span>
  _Sequence c<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h2 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h2><p><code>同理，属于 container adaptor，可以指定其他支持 back()、push_back()、pop_back() 接口的容器作为 queue 的内部结构，如：std::queue&lt;int, std::list&lt;int&gt;&gt; linkedQueue 。</code></p>
<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/queue.png">

<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span> <span class="token operator">=</span> deque<span class="token operator">&lt;</span>_Tp<span class="token operator">></span> <span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">queue</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>value_type		value_type<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>reference		reference<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>const_reference	const_reference<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>size_type		size_type<span class="token punctuation">;</span>
 <span class="token keyword">typedef</span>		_Sequence			container_type<span class="token punctuation">;</span>

 _GLIBCXX_NODISCARD <span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
 <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

 size_type  <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
 <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

 reference <span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 reference <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span>
 <span class="token punctuation">&#123;</span> c<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

 <span class="token keyword">void</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   c<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Seq</span><span class="token operator">></span>
 <span class="token keyword">inline</span> <span class="token keyword">bool</span>
 <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> queue<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> <span class="token keyword">const</span> queue<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __y<span class="token punctuation">)</span>
 <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> __x<span class="token punctuation">.</span>c <span class="token operator">==</span> __y<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

 <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Seq</span><span class="token operator">></span>
 <span class="token keyword">inline</span> <span class="token keyword">bool</span>
 <span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> queue<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> <span class="token keyword">const</span> queue<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Seq<span class="token operator">></span><span class="token operator">&amp;</span> __y<span class="token punctuation">)</span>
 <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> __x<span class="token punctuation">.</span>c <span class="token operator">&lt;</span> __y<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
 _Sequence c<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h2 id="heap"><a href="#heap" class="headerlink" title="heap"></a>heap</h2><p><code>非 STL 容器组件，作为 priority_queue 的底层机制。</code></p>
<p><code>binary heap 是 complete binary tree（完全二叉树）的数组实现。</code></p>
<p><code>一个数组 + 一组 heap 算法（插入元素、删除元素、取极值、排列成 heap）。</code></p>
<p><code>对于整个堆，以及子堆， 最大堆（最小堆）的最大（最小值）在（子）堆的根节点。</code></p>
<p><br/><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/binary-heap.png"></p>
<br/>

<h3 id="push-heap"><a href="#push-heap" class="headerlink" title="push_heap()"></a>push_heap()</h3><p><code>为了满足完全二叉树的条件：</code></p>
<p><code>首先，新加入元素置于尾部。</code></p>
<p><code>其次，为了满足 max-heap 或者 min-heap 等的条件，需要做 percolate up(上溯) 调整。</code></p>
<p><code>令当前洞号为添加的新尾部节点，和其父节点的键值对比，如果符合对比策略，就让父节点和子节点对换位置，更新洞号，一直上溯，直到不需要对换或到根节点为止。</code></p>
<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token operator">></span>
<span class="token keyword">inline</span> <span class="token keyword">void</span>
<span class="token function">push_heap</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">></span><span class="token double-colon punctuation">::</span>difference_type
    _DistanceType<span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token comment">// 调用如下函数时，新元素已经置于底部容器最尾端</span>
__gnu_cxx<span class="token double-colon punctuation">::</span>__ops<span class="token double-colon punctuation">::</span>_Iter_less_val __comp<span class="token punctuation">;</span>
_ValueType __value <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>__last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span><span class="token function">__push_heap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> <span class="token function">_DistanceType</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__last <span class="token operator">-</span> __first<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token function">_DistanceType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__value<span class="token punctuation">)</span><span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 允许指定比较策略</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Distance</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span>
<span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">__push_heap</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>
        _Distance __holeIndex<span class="token punctuation">,</span> _Distance __topIndex<span class="token punctuation">,</span> _Tp __value<span class="token punctuation">,</span>
        _Compare<span class="token operator">&amp;</span> __comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 找到压入的尾端节点的父节点位置</span>
 _Distance __parent <span class="token operator">=</span> <span class="token punctuation">(</span>__holeIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
 <span class="token comment">// 当尚未到达顶端，且父节点在 __comp 比较策略下符合 value 值 </span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span>__holeIndex <span class="token operator">></span> __topIndex <span class="token operator">&amp;&amp;</span> <span class="token function">__comp</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __parent<span class="token punctuation">,</span> __value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 洞值（当前子节点）为父节点值</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __holeIndex<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __parent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调整洞号，继续 percolateUp(上溯)</span>
    __holeIndex <span class="token operator">=</span> __parent<span class="token punctuation">;</span>
    __parent <span class="token operator">=</span> <span class="token punctuation">(</span>__holeIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span> <span class="token comment">// 持续到满足 heap 次序特性或者顶端为止</span>
 <span class="token comment">// 更新终止处的值</span>
 <span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __holeIndex<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img title="push_heap" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/push-heap.png">

<p><br/><br/>### pop_heap()</p>
<p><code>要保持完全二叉树的条件：</code></p>
<p><code>首先，记录最后一个叶子节点（即尾节点）的值备用。</code></p>
<p><code>其次，将根节点的值替换到尾节点，不会被立即弹出。如果需要，可后续调用 back()、pop_back() 访取。</code></p>
<p><code>为了满足 max-heap 或者 min-heap 等的条件，需要做 percolate down(下溯) 调整。</code></p>
<p><code>令洞号为根节点，和其孩子节点（包括左孩子和右孩子）做对比，如果符合某种比较策略，就互换值，更新洞号，继续下溯，直到子堆叶子节点为止，然后将整个堆的最后一个叶子节点（最下层，最右边）的值，设给这个“已经到达子堆叶层的洞号节点”，再对这个洞号节点进行 percolate up （上溯）。</code></p>
<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">></span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">pop_heap</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>
             _RandomAccessIterator __last<span class="token punctuation">,</span> _Compare __comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 自定义 compare 规则</span>
 <span class="token keyword">typedef</span> <span class="token function">__decltype</span><span class="token punctuation">(</span>__comp<span class="token punctuation">)</span> _Cmp<span class="token punctuation">;</span>
 __gnu_cxx<span class="token double-colon punctuation">::</span>__ops<span class="token double-colon punctuation">::</span>_Iter_comp_iter<span class="token operator">&lt;</span>_Cmp<span class="token operator">></span> <span class="token function">__cmp</span><span class="token punctuation">(</span><span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__comp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token operator">--</span>__last<span class="token punctuation">;</span> <span class="token comment">// 调整 last 指向最后一个叶子节点</span>
 std<span class="token double-colon punctuation">::</span><span class="token function">__pop_heap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">></span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">__pop_heap</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span>
  									 _RandomAccessIterator __result<span class="token punctuation">,</span> _Compare<span class="token operator">&amp;</span> __comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">></span><span class="token double-colon punctuation">::</span>value_type
 _ValueType<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">></span><span class="token double-colon punctuation">::</span>difference_type
 _DistanceType<span class="token punctuation">;</span>
<span class="token comment">// 先记录尾节点（最后一个叶子节点值）</span>
_ValueType __value <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span>__result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将要 pop 的元素（即容器的第一个元素）赋值到 尾节点</span>
<span class="token operator">*</span>__result <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span>__first<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// _DistanceType(0) 代表以根节点为洞号，进行下溯，重新调整 heap</span>
std<span class="token double-colon punctuation">::</span><span class="token function">__adjust_heap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> <span class="token function">_DistanceType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">_DistanceType</span><span class="token punctuation">(</span>__last <span class="token operator">-</span> __first<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__value<span class="token punctuation">)</span><span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Distance</span><span class="token punctuation">,</span>
<span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">__adjust_heap</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _Distance __holeIndex<span class="token punctuation">,</span>
       				 _Distance __len<span class="token punctuation">,</span> _Tp __value<span class="token punctuation">,</span> _Compare __comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">const</span> _Distance __topIndex <span class="token operator">=</span> __holeIndex<span class="token punctuation">;</span>
_Distance __secondChild <span class="token operator">=</span> __holeIndex<span class="token punctuation">;</span>

<span class="token comment">// (__len - 1) / 2 指向的是最后一个非叶子节点的节点</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>__secondChild <span class="token operator">&lt;</span> <span class="token punctuation">(</span>__len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 首先，定位到右孩子节点</span>
 __secondChild <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>__secondChild <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 如果左孩子节点比右孩子节点更符合 comp 策略（大），则定位到左孩子节点</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __secondChild<span class="token punctuation">,</span> __first <span class="token operator">+</span> <span class="token punctuation">(</span>__secondChild <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   __secondChild<span class="token operator">--</span><span class="token punctuation">;</span>
 <span class="token comment">// 让当前洞号的孩子节点覆盖当前洞号值</span>
 <span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __holeIndex<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __secondChild<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 更新当前洞号指向孩子节点，继续下溯</span>
 __holeIndex <span class="token operator">=</span> __secondChild<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token comment">// 如果当前洞号的孩子节点大于尾节点的父节点停止下溯</span>

<span class="token comment">// 特殊处理</span>
<span class="token comment">// __len &amp; 1 == 0 表示 __len 为偶数， </span>
<span class="token comment">// 即尾端结点属于左孩子节点类型,</span>
<span class="token comment">// 并且当前 __secondChild 指向尾节点的父节点</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__len <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> __secondChild <span class="token operator">==</span> <span class="token punctuation">(</span>__len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 将 __secondChild 定位到最尾端节点（左孩子节点类型）</span>
 __secondChild <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>__secondChild <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __holeIndex<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> <span class="token punctuation">(</span>__secondChild <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 __holeIndex <span class="token operator">=</span> __secondChild <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">__decltype</span><span class="token punctuation">(</span>__gnu_cxx<span class="token double-colon punctuation">::</span>__ops<span class="token double-colon punctuation">::</span><span class="token function">__iter_comp_val</span><span class="token punctuation">(</span><span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__comp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token function">__cmp</span><span class="token punctuation">(</span><span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__comp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span><span class="token function">__push_heap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __holeIndex<span class="token punctuation">,</span> __topIndex<span class="token punctuation">,</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__value<span class="token punctuation">)</span><span class="token punctuation">,</span> __cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/pop-heap.png">

<br/>

<p><strong>__adjust_heap() 中 最后一步 __push_heap() 的重要性</strong></p>
<br/>

<h3 id="sort-heap"><a href="#sort-heap" class="headerlink" title="sort_heap()"></a>sort_heap()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">__sort_heap</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span>
              _Compare<span class="token operator">&amp;</span> __comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 执行一次 __pop_heap()，（根据__comp比较策略）极值放在尾端</span>
 <span class="token comment">// 再执行一次 __pop_heap()，次极值放在新的尾端，</span>
 <span class="token comment">// 如此下去，最后得到的便是排好序的区间 [first, last)</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">--</span>__last<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">__pop_heap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/sort-heap.png">

<br/>

<h3 id="make-heap"><a href="#make-heap" class="headerlink" title="make_heap()"></a>make_heap()</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">></span>
<span class="token keyword">void</span> <span class="token function">__make_heap</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span>
      _Compare<span class="token operator">&amp;</span> __comp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">></span><span class="token double-colon punctuation">::</span>value_type _ValueType<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">iterator_traits</span><span class="token operator">&lt;</span>_RandomAccessIterator<span class="token operator">></span><span class="token double-colon punctuation">::</span>difference_type _DistanceType<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> _DistanceType __len <span class="token operator">=</span> __last <span class="token operator">-</span> __first<span class="token punctuation">;</span>
  <span class="token comment">// 由于任何叶节点都不需要执行 percolate down，所以指定 __parent = (__len - 2) / 2</span>
<span class="token comment">// parent 对应的是 之前提及的 holeIndex</span>
_DistanceType __parent <span class="token operator">=</span> <span class="token punctuation">(</span>__len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token comment">// 重排以 parent 为首的子树。</span>
 _ValueType __value <span class="token operator">=</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> __parent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 std<span class="token double-colon punctuation">::</span><span class="token function">__adjust_heap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __parent<span class="token punctuation">,</span> __len<span class="token punctuation">,</span> <span class="token function">_GLIBCXX_MOVE</span><span class="token punctuation">(</span>__value<span class="token punctuation">)</span><span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>__parent <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span><span class="token punctuation">;</span>
 __parent<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<h2 id="priority-queue"><a href="#priority-queue" class="headerlink" title="priority_queue"></a>priority_queue</h2><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/priority_queue.png">

<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span> <span class="token operator">=</span> vector<span class="token operator">&lt;</span>_Tp<span class="token operator">></span><span class="token punctuation">,</span>
<span class="token keyword">typename</span> <span class="token class-name">_Compare</span>  <span class="token operator">=</span> less<span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>value_type<span class="token operator">></span> <span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">priority_queue</span> <span class="token punctuation">&#123;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">__cplusplus <span class="token operator">>=</span> <span class="token number">201103L</span></span></span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">using</span> _Uses <span class="token operator">=</span> <span class="token keyword">typename</span>
<span class="token class-name">enable_if</span><span class="token operator">&lt;</span>uses_allocator<span class="token operator">&lt;</span>_Sequence<span class="token punctuation">,</span> _Alloc<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token operator">></span><span class="token double-colon punctuation">::</span>type<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">__cplusplus <span class="token operator">>=</span> <span class="token number">201703L</span></span></span>
<span class="token keyword">static_assert</span><span class="token punctuation">(</span>is_same<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>value_type<span class="token operator">></span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span>
             <span class="token string">"value_type must be the same as the underlying container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// C++17</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// C++11</span></span>

<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>value_type		value_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>reference		reference<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>const_reference	const_reference<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span>	<span class="token class-name">_Sequence</span><span class="token double-colon punctuation">::</span>size_type		size_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span>		_Sequence			container_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span>	   _Compare				value_compare<span class="token punctuation">;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
_Sequence  c<span class="token punctuation">;</span>
_Compare   comp<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">explicit</span> <span class="token function">priority_queue</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Compare<span class="token operator">&amp;</span> __x<span class="token punctuation">,</span> <span class="token keyword">const</span> _Sequence<span class="token operator">&amp;</span> __s<span class="token punctuation">)</span>
 <span class="token operator">:</span> <span class="token function">c</span><span class="token punctuation">(</span>__s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">comp</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
   std<span class="token double-colon punctuation">::</span><span class="token function">make_heap</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> comp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span>

_GLIBCXX_NODISCARD <span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

size_type <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

const_reference <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>
 <span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 c<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>
 std<span class="token double-colon punctuation">::</span><span class="token function">push_heap</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 <span class="token function">__glibcxx_requires_nonempty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 取出极值放在尾端，重排 heap</span>
 std<span class="token double-colon punctuation">::</span><span class="token function">pop_heap</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 真正意义的取出元素</span>
 c<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> _Args<span class="token operator">></span> <span class="token keyword">void</span> <span class="token function">emplace</span><span class="token punctuation">(</span>_Args<span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> __args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 c<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Args<span class="token operator">></span></span></span><span class="token punctuation">(</span>__args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 std<span class="token double-colon punctuation">::</span><span class="token function">push_heap</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<br/>

<h2 id="slist"><a href="#slist" class="headerlink" title="slist"></a>slist</h2><br/>

<table>
<thead>
<tr>
<th align="center">slist</th>
<th align="center">list</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>singly</strong> linked list</td>
<td align="center"><strong>double</strong> linked list</td>
</tr>
<tr>
<td align="center">Forward Iterator</td>
<td align="center">Bidirectional Iterator</td>
</tr>
<tr>
<td align="center">头插法插入新元素，只提供 <strong>push_front()</strong></td>
<td align="center"></td>
</tr>
</tbody></table>
<br/>

<h3 id="slist-的节点和迭代器数据结构"><a href="#slist-的节点和迭代器数据结构" class="headerlink" title="slist 的节点和迭代器数据结构"></a>slist 的节点和迭代器数据结构</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">_Slist_node_base</span> <span class="token punctuation">&#123;</span>
  _Slist_node_base<span class="token operator">*</span> _M_next<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">_Slist_node</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">_Slist_node_base</span></span> <span class="token punctuation">&#123;</span>
  _Tp _M_data<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">_Slist_iterator_base</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">typedef</span> size_t                    size_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> ptrdiff_t                 difference_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>forward_iterator_tag iterator_category<span class="token punctuation">;</span> <span class="token comment">// 单向</span>

_Slist_node_base<span class="token operator">*</span> _M_node<span class="token punctuation">;</span>

<span class="token function">_Slist_iterator_base</span><span class="token punctuation">(</span>_Slist_node_base<span class="token operator">*</span> __x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_M_node</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">_M_incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
_M_node <span class="token operator">=</span> _M_node<span class="token operator">-></span>_M_next<span class="token punctuation">;</span> 	<span class="token comment">// 前进一个节点</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Slist_iterator_base<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> _M_node <span class="token operator">==</span> __x<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> _Slist_iterator_base<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> _M_node <span class="token operator">!=</span> __x<span class="token punctuation">.</span>_M_node<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 迭代器结构</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Ptr</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">_Slist_iterator</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">_Slist_iterator_base</span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">typedef</span> _Slist_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> _Tp<span class="token operator">*</span><span class="token operator">></span>             iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Slist_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">*</span><span class="token operator">></span> const_iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Slist_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Ref<span class="token punctuation">,</span> _Ptr<span class="token operator">></span>             _Self<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> _Tp              value_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Ptr             pointer<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Ref             reference<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Slist_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span> _Node<span class="token punctuation">;</span>

<span class="token keyword">explicit</span> <span class="token function">_Slist_iterator</span><span class="token punctuation">(</span>_Node<span class="token operator">*</span> __x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_Slist_iterator_base</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token comment">// 因为       iterator end()  &#123; return iterator(0); &#125;</span>
<span class="token function">_Slist_iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_Slist_iterator_base</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token function">_Slist_iterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> iterator<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_Slist_iterator_base</span><span class="token punctuation">(</span>__x<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

reference <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> _M_node<span class="token punctuation">)</span><span class="token operator">-></span>_M_data<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

pointer <span class="token keyword">operator</span><span class="token operator">-></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

_Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token function">_M_incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 前进一个节点</span>
<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

_Self <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  _Self __tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token function">_M_incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 前进一个节点</span>
  <span class="token keyword">return</span> __tmp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/slist-node-and-iterator.png">



<br/>

<br/>

<h3 id="slist-之-新节点创建"><a href="#slist-之-新节点创建" class="headerlink" title="slist 之 新节点创建"></a>slist 之 新节点创建</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">inline</span> _Slist_node_base<span class="token operator">*</span>
 <span class="token function">__slist_make_link</span><span class="token punctuation">(</span>_Slist_node_base<span class="token operator">*</span> __prev_node<span class="token punctuation">,</span> _Slist_node_base<span class="token operator">*</span> __new_node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 __new_node<span class="token operator">-></span>_M_next <span class="token operator">=</span> __prev_node<span class="token operator">-></span>_M_next<span class="token punctuation">;</span>
 __prev_node<span class="token operator">-></span>_M_next <span class="token operator">=</span> __new_node<span class="token punctuation">;</span>
 <span class="token keyword">return</span> __new_node<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// _Slist_base</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span><span class="token operator">></span>
<span class="token keyword">struct</span> <span class="token class-name">_Slist_base</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> _Alloc<span class="token double-colon punctuation">::</span><span class="token keyword">template</span> <span class="token class-name">rebind</span><span class="token operator">&lt;</span><span class="token class-name">_Slist_node</span><span class="token operator">&lt;</span><span class="token class-name">_Tp</span><span class="token operator">></span> <span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token class-name">other</span></span> <span class="token punctuation">&#123;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">_Alloc</span><span class="token double-colon punctuation">::</span><span class="token keyword">template</span> rebind<span class="token operator">&lt;</span>_Slist_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span> <span class="token operator">></span><span class="token double-colon punctuation">::</span>other
 _Node_alloc<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Alloc allocator_type<span class="token punctuation">;</span>

allocator_type <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> <span class="token operator">*</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> _Node_alloc<span class="token operator">*</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token function">_Slist_base</span><span class="token punctuation">(</span><span class="token keyword">const</span> allocator_type<span class="token operator">&amp;</span> __a<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_Node_alloc</span><span class="token punctuation">(</span>__a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">.</span>_M_next <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token operator">~</span><span class="token function">_Slist_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 <span class="token function">_M_erase_after</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
_Slist_node_base _M_head<span class="token punctuation">;</span> <span class="token comment">// 头部，非指针类型</span>

_Slist_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span><span class="token operator">*</span> <span class="token function">_M_get_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> _Node_alloc<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">_M_put_node</span><span class="token punctuation">(</span>_Slist_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span><span class="token operator">*</span> __p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 _Node_alloc<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span>__p<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
_Slist_node_base<span class="token operator">*</span> <span class="token function">_M_erase_after</span><span class="token punctuation">(</span>_Slist_node_base<span class="token operator">*</span> __pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 _Slist_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span><span class="token operator">*</span> __next <span class="token operator">=</span> <span class="token punctuation">(</span>_Slist_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>__pos<span class="token operator">-></span>_M_next<span class="token punctuation">)</span><span class="token punctuation">;</span>
 _Slist_node_base<span class="token operator">*</span> __next_next <span class="token operator">=</span> __next<span class="token operator">-></span>_M_next<span class="token punctuation">;</span>
 __pos<span class="token operator">-></span>_M_next <span class="token operator">=</span> __next_next<span class="token punctuation">;</span>
 <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>__next<span class="token operator">-></span>_M_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">_M_put_node</span><span class="token punctuation">(</span>__next<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> __next_next<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
_Slist_node_base<span class="token operator">*</span> <span class="token function">_M_erase_after</span><span class="token punctuation">(</span>_Slist_node_base<span class="token operator">*</span><span class="token punctuation">,</span> _Slist_node_base<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// slist</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Alloc</span> <span class="token operator">=</span> allocator<span class="token operator">&lt;</span>_Tp<span class="token operator">></span> <span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">slist</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">private</span> <span class="token class-name">_Slist_base</span><span class="token operator">&lt;</span><span class="token class-name">_Tp</span><span class="token punctuation">,</span><span class="token class-name">_Alloc</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
<span class="token keyword">typedef</span> _Slist_base<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span>_Alloc<span class="token operator">></span> _Base<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">typedef</span> _Tp               value_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> value_type<span class="token operator">*</span>       pointer<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">const</span> value_type<span class="token operator">*</span> const_pointer<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> value_type<span class="token operator">&amp;</span>       reference<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> const_reference<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> size_t            size_type<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> ptrdiff_t         difference_type<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> _Slist_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> _Tp<span class="token operator">*</span><span class="token operator">></span>             iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> _Slist_iterator<span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> _Tp<span class="token operator">*</span><span class="token operator">></span> const_iterator<span class="token punctuation">;</span>

  <span class="token comment">// 构造元素 </span>
_Node<span class="token operator">*</span> <span class="token function">_M_create_node</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 _Node<span class="token operator">*</span> __node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_get_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 __try <span class="token punctuation">&#123;</span>
   <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>__node<span class="token operator">-></span>_M_data<span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
   __node<span class="token operator">-></span>_M_next <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token function">__catch</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_put_node</span><span class="token punctuation">(</span>__node<span class="token punctuation">)</span><span class="token punctuation">;</span>
   __throw_exception_again<span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token keyword">return</span> __node<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 析构元素</span>
<span class="token keyword">void</span> <span class="token function">_M_put_node</span><span class="token punctuation">(</span>_Slist_node<span class="token operator">&lt;</span>_Tp<span class="token operator">></span><span class="token operator">*</span> __p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 _Node_alloc<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span>__p<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">.</span>_M_next<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
<span class="token comment">// 互换 slist</span>
  <span class="token keyword">void</span>  <span class="token function">swap</span><span class="token punctuation">(</span>slist<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">.</span>_M_next<span class="token punctuation">,</span> __x<span class="token punctuation">.</span>_M_head<span class="token punctuation">.</span>_M_next<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

const_reference <span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">.</span>_M_next<span class="token punctuation">)</span><span class="token operator">-></span>_M_data<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
  <span class="token comment">// 头插法插入一个元素</span>
<span class="token keyword">void</span> <span class="token function">push_front</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 <span class="token function">__slist_make_link</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">,</span> <span class="token function">_M_create_node</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>
<span class="token comment">// 弹出并删除头部元素</span>
<span class="token keyword">void</span> <span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 _Node<span class="token operator">*</span> __node <span class="token operator">=</span> <span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">.</span>_M_next<span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">.</span>_M_next <span class="token operator">=</span> __node<span class="token operator">-></span>_M_next<span class="token punctuation">;</span>
 <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>__node<span class="token operator">-></span>_M_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_put_node</span><span class="token punctuation">(</span>__node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 擦除元素</span>
iterator <span class="token function">erase</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
 <span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token operator">-></span><span class="token function">_M_erase_after</span>
                 <span class="token punctuation">(</span><span class="token function">__slist_previous</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">,</span> __pos<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<h3 id="slist-其他方法"><a href="#slist-其他方法" class="headerlink" title="slist 其他方法"></a>slist 其他方法</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">inline</span> _Slist_node_base<span class="token operator">*</span>
<span class="token function">__slist_previous</span><span class="token punctuation">(</span>_Slist_node_base<span class="token operator">*</span> __head<span class="token punctuation">,</span> <span class="token keyword">const</span> _Slist_node_base<span class="token operator">*</span> __node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>__head <span class="token operator">&amp;&amp;</span> __head<span class="token operator">-></span>_M_next <span class="token operator">!=</span> __node<span class="token punctuation">)</span>
 __head <span class="token operator">=</span> __head<span class="token operator">-></span>_M_next<span class="token punctuation">;</span>
<span class="token keyword">return</span> __head<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

const_iterator <span class="token function">previous</span><span class="token punctuation">(</span>const_iterator __pos<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> consß<span class="token function">t_iterator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">__slist_previous</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">,</span> __pos<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

_Node<span class="token operator">*</span> <span class="token function">_M_insert_after</span><span class="token punctuation">(</span>_Node_base<span class="token operator">*</span> __pos<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> <span class="token punctuation">(</span>_Node<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">__slist_make_link</span><span class="token punctuation">(</span>__pos<span class="token punctuation">,</span> <span class="token function">_M_create_node</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

iterator <span class="token function">insert</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token function">_M_insert_after</span><span class="token punctuation">(</span><span class="token function">__slist_previous</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">,</span> __pos<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span><span class="token punctuation">,</span>
                               <span class="token function">value_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>iterator __pos<span class="token punctuation">,</span> size_type __n<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> __x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token function">_M_insert_after_fill</span><span class="token punctuation">(</span><span class="token function">__slist_previous</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token operator">-></span>_M_head<span class="token punctuation">,</span> __pos<span class="token punctuation">.</span>_M_node<span class="token punctuation">)</span><span class="token punctuation">,</span>  __n<span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<br/>

<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/STL/slist-insert-erase.png">
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">JoyChen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/06/18/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8%EF%BC%88sequence%20containers%EF%BC%89/">http://example.com/2021/06/18/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8%EF%BC%88sequence%20containers%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">JoyChen's 知识星球</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97/">拆书系列</a><a class="post-meta__tags" href="/tags/STL/">STL</a></div><div class="post_share"><div class="social-share" data-image="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-15.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/19/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E7%AE%97%E6%B3%95%EF%BC%88algorithms%EF%BC%89/"><img class="prev-cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-10.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">拆书系列之《STL源码剖析》算法（Algorithm）</div></div></a></div><div class="next-post pull-right"><a href="/2021/06/08/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E6%A6%82%E8%BF%B0/"><img class="next-cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-12.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">拆书系列之《STL 源码剖析》概述</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/06/19/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8%EF%BC%88associative%20containers%EF%BC%89/" title="拆书系列之《STL源码剖析》关联式容器（associative containers）"><img class="cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-13.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-19</div><div class="title">拆书系列之《STL源码剖析》关联式容器（associative containers）</div></div></a></div><div><a href="/2021/07/08/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E4%BB%BF%E5%87%BD%E6%95%B0%EF%BC%88functors%EF%BC%89/" title="拆书系列之《STL 源码剖析》仿函数（functors）"><img class="cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-11.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-08</div><div class="title">拆书系列之《STL 源码剖析》仿函数（functors）</div></div></a></div><div><a href="/2021/06/08/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E6%A6%82%E8%BF%B0/" title="拆书系列之《STL 源码剖析》概述"><img class="cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-12.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-08</div><div class="title">拆书系列之《STL 源码剖析》概述</div></div></a></div><div><a href="/2021/06/19/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8%EF%BC%88allocator%EF%BC%89/" title="拆书系列之《STL 源码剖析》空间配置器（allocator）"><img class="cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-8.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-19</div><div class="title">拆书系列之《STL 源码剖析》空间配置器（allocator）</div></div></a></div><div><a href="/2021/06/19/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E7%AE%97%E6%B3%95%EF%BC%88algorithms%EF%BC%89/" title="拆书系列之《STL源码剖析》算法（Algorithm）"><img class="cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-10.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-19</div><div class="title">拆书系列之《STL源码剖析》算法（Algorithm）</div></div></a></div><div><a href="/2021/06/23/STL/%E6%8B%86%E4%B9%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%88iterators%EF%BC%89/" title="拆书系列之《STL 源码剖析》迭代器（iterators）"><img class="cover" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-23</div><div class="title">拆书系列之《STL 源码剖析》迭代器（iterators）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JoyChen</div><div class="author-info__description">If you haven't found it yet Keep looking Don't settle</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/JoyChenNo1"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/JoyChenNo1" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:joychenisno1@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%80%8ASTL%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E3%80%8B%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8%EF%BC%88sequence-containers%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">《STL源码剖析》序列式容器（sequence containers）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vector"><span class="toc-number">1.1.</span> <span class="toc-text">vector</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vector-%E4%BB%A3%E7%A0%81%E6%91%98%E8%A6%81%EF%BC%88GCC-%E7%89%88%E6%9C%AC%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">vector 代码摘要（GCC 版本）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector-%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">vector 的迭代器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.3.</span> <span class="toc-text">vector 的数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.1.4.</span> <span class="toc-text">vector 初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector-%E4%B9%8B-insert"><span class="toc-number">1.1.5.</span> <span class="toc-text">vector 之 insert()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector-%E4%B9%8B-erase"><span class="toc-number">1.1.6.</span> <span class="toc-text">vector 之 erase()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#list"><span class="toc-number">1.2.</span> <span class="toc-text">list</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E8%8A%82%E7%82%B9"><span class="toc-number">1.2.1.</span> <span class="toc-text">list 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.2.2.</span> <span class="toc-text">list 迭代器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.3.</span> <span class="toc-text">list 数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E4%B9%8B-unique"><span class="toc-number">1.2.4.</span> <span class="toc-text">list 之 unique()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E4%B9%8B-erase"><span class="toc-number">1.2.5.</span> <span class="toc-text">list 之 erase()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#transfer"><span class="toc-number">1.2.6.</span> <span class="toc-text">transfer()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E4%B9%8B-splice"><span class="toc-number">1.2.7.</span> <span class="toc-text">list 之 splice()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E4%B9%8B-merge"><span class="toc-number">1.2.8.</span> <span class="toc-text">list 之 merge()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E4%B9%8B-reverse"><span class="toc-number">1.2.9.</span> <span class="toc-text">list 之 reverse()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#list-%E4%B9%8B-sort"><span class="toc-number">1.2.10.</span> <span class="toc-text">list 之 sort()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deque"><span class="toc-number">1.3.</span> <span class="toc-text">deque</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">deque 迭代器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E5%88%9B%E5%BB%BA"><span class="toc-number">1.3.2.</span> <span class="toc-text">deque 创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E4%B9%8B-push-back"><span class="toc-number">1.3.3.</span> <span class="toc-text">deque 之 push_back()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E4%B9%8B-pop-back"><span class="toc-number">1.3.4.</span> <span class="toc-text">deque 之 pop_back()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E4%B9%8B-push-front"><span class="toc-number">1.3.5.</span> <span class="toc-text">deque 之 push_front()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E4%B9%8B-pop-front"><span class="toc-number">1.3.6.</span> <span class="toc-text">deque 之 pop_front()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%8E%A7%E5%99%A8"><span class="toc-number">1.3.7.</span> <span class="toc-text">重新配置中控器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E4%B9%8B-insert"><span class="toc-number">1.3.8.</span> <span class="toc-text">deque 之 insert()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E4%B9%8B-erase"><span class="toc-number">1.3.9.</span> <span class="toc-text">deque 之 erase()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deque-%E4%B9%8B-clear"><span class="toc-number">1.3.10.</span> <span class="toc-text">deque 之 clear()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stack"><span class="toc-number">1.4.</span> <span class="toc-text">stack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#queue"><span class="toc-number">1.5.</span> <span class="toc-text">queue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#heap"><span class="toc-number">1.6.</span> <span class="toc-text">heap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#push-heap"><span class="toc-number">1.6.1.</span> <span class="toc-text">push_heap()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sort-heap"><span class="toc-number">1.6.2.</span> <span class="toc-text">sort_heap()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make-heap"><span class="toc-number">1.6.3.</span> <span class="toc-text">make_heap()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#priority-queue"><span class="toc-number">1.7.</span> <span class="toc-text">priority_queue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#slist"><span class="toc-number">1.8.</span> <span class="toc-text">slist</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#slist-%E7%9A%84%E8%8A%82%E7%82%B9%E5%92%8C%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.8.1.</span> <span class="toc-text">slist 的节点和迭代器数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#slist-%E4%B9%8B-%E6%96%B0%E8%8A%82%E7%82%B9%E5%88%9B%E5%BB%BA"><span class="toc-number">1.8.2.</span> <span class="toc-text">slist 之 新节点创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#slist-%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.3.</span> <span class="toc-text">slist 其他方法</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DDD设计模式"/></a><div class="content"><a class="title" href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式">DDD设计模式</a><time datetime="2024-04-11T14:08:00.000Z" title="发表于 2024-04-11 22:08:00">2024-04-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 基础镜像构建示例"/></a><div class="content"><a class="title" href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例">Docker 基础镜像构建示例</a><time datetime="2024-01-14T12:08:00.000Z" title="发表于 2024-01-14 20:08:00">2024-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/13/%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95/go-tool%E4%B9%8Bpprof%E7%9A%84%E4%BD%BF%E7%94%A8/" title="go 服务调试之pprof"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="go 服务调试之pprof"/></a><div class="content"><a class="title" href="/2024/01/13/%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95/go-tool%E4%B9%8Bpprof%E7%9A%84%E4%BD%BF%E7%94%A8/" title="go 服务调试之pprof">go 服务调试之pprof</a><time datetime="2024-01-13T12:08:00.000Z" title="发表于 2024-01-13 20:08:00">2024-01-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-15.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By JoyChen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script></div><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/js/index.js"></script><!-- hexo injector body_end end --></body></html>