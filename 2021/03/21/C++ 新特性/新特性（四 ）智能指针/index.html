<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">













    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            C++1x 新特性（四）智能指针 | 
        
        进阶之路
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content=",C++11 C++14 C++17">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?Dp7k2X9uh6CgQx67yceHxQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?CC5Yjp011Bf1QgvH2to+Cw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tomorrow-night-bright.min.css?POjR8UWU/nzYlm7nv2wGjQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "monaco", Helvetica, "PingFang SC", "Hiragino Sans GB", Arial, sans-serif, monaco;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #333332 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #333332 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #333332 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #2a2d37;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="进阶之路">
    <meta name="msapplication-starturl" content="http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="进阶之路">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="C++1x 新特性（四）智能指针 | 进阶之路">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="">
    <meta property="og:article:tag" content="C++11 C++14 C++17"> 

    
        <meta property="article:published_time" content="Sun Mar 21 2021 23:37:48 GMT+0800">
        <meta property="article:modified_time" content="Sat Jul 17 2021 11:19:22 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/index.html",
    "headline": "C++1x 新特性（四）智能指针",
    "datePublished": "Sun Mar 21 2021 23:37:48 GMT+0800",
    "dateModified": "Sat Jul 17 2021 11:19:22 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Joy Chen",
        "image": {
            "@type": "ImageObject",
            "url": "/img/me.png"
        },
        "description": "永远怀着一颗学徒的心"
    },
    "publisher": {
        "@type": "Organization",
        "name": "进阶之路",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",C++11 C++14 C++17",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

<meta name="generator" content="Hexo 5.4.0"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#C-1x-%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="post-toc-number">1.</span> <span class="post-toc-text">C++1x 新特性（四）智能指针</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#RAII-%EF%BC%88%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96%E5%8D%B3%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%89"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">RAII （资源获取即初始化）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#auto-ptr"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">auto_ptr</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#std-shared-ptr"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">std::shared_ptr</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#std-unique-ptr"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">std::unique_ptr</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#std-weak-ptr"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">std::weak_ptr</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#std-enable-shared-from-this"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">std::enable_shared_from_this</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">注意事项</span></a></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--6dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                C++1x 新特性（四）智能指针
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/me.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Joy Chen</strong>
        <span>3月 21, 2021</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-none-link" href="/tags/C-11-C-14-C-17/" rel="tag">C++11 C++14 C++17</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=C++1x 新特性（四）智能指针&url=http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/index.html&via=Joy Chen" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/index.html&title=C++1x 新特性（四）智能指针" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=进阶之路&title=C++1x 新特性（四）智能指针&summary=&pics=http://example.com/img/favicon.png&url=http://example.com/2021/03/21/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E5%9B%9B%20%EF%BC%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="C-1x-新特性（四）智能指针"><a href="#C-1x-新特性（四）智能指针" class="headerlink" title="C++1x 新特性（四）智能指针"></a>C++1x 新特性（四）智能指针</h1><p><code>本系列主要阐述依据：</code></p>
<p>[<a target="_blank" rel="noopener" href="https://github.com/changkun/modern-cpp-tutorial]">https://github.com/changkun/modern-cpp-tutorial]</a>: 《Modern C++ Tutorial: C++11/14/17/20 On the Fly》</p>
<br/>

<br/>

<h2 id="RAII-（资源获取即初始化）"><a href="#RAII-（资源获取即初始化）" class="headerlink" title="RAII （资源获取即初始化）"></a><strong>RAII （资源获取即初始化）</strong></h2><p><code>存在中途抛出异常等情况导致 new 和 delete 带来的的内存泄露问题。 </code></p>
<br/>

<br/>

<h2 id="auto-ptr"><a href="#auto-ptr" class="headerlink" title="auto_ptr"></a>auto_ptr</h2><p><code>C++98提供的智能指针，现在废弃，用具有基本相同效果、更高安全性的 unique_ptr 替代。</code></p>
<table>
<thead>
<tr>
<th>auto_ptr</th>
<th>unique_ptr</th>
</tr>
</thead>
<tbody><tr>
<td>对于数组类型只会调用 delete 释放</td>
<td>可以正确处理数组类型，会调用 delete[] 释放</td>
</tr>
<tr>
<td>std::auto_ptr<int> p(new int);                                            std::auto_ptr<int> p2 = p;  // 隐式移交所有权</td>
<td>std::unique_ptr<int> p(new int); std::unique_ptr<int> p2 = std::move(p);  // 显式移交所有权</td>
</tr>
</tbody></table>
<br/>

<br/>

<h2 id="std-shared-ptr"><a href="#std-shared-ptr" class="headerlink" title="std::shared_ptr"></a><strong>std::shared_ptr</strong></h2><table>
<thead>
<tr>
<th>操作</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>make_shared<T>(args)</td>
<td>工厂构造函数</td>
</tr>
<tr>
<td>p = q</td>
<td>p 和 q 可以互相转换的智能指针，该操作会减少 p 的引用计数， 增加 q 的引用计数，如果 p 的引用计数为 0，会释放当前 p 指向的对象。</td>
</tr>
<tr>
<td>shared_ptr<T> p(q)</td>
<td>q 可以转换成 T* 类型，智能指针 p 是 q 的拷贝，这会增加 q 的引用计数。</td>
</tr>
<tr>
<td>p.unique()</td>
<td>如果p.use_count == 1, 返回 <code>true</code> （C++17 deprecated, C++20 removed）</td>
</tr>
<tr>
<td>p.use_count()</td>
<td>查看对象当前的引用计数</td>
</tr>
</tbody></table>
<br/>

<p><strong>可以这么实现一个 share_ptr</strong></p>
<blockquote>
<pre><code class="cpp">// 简单实现一个 shared_ptr

#include &lt;iostream&gt;

class RefCount &#123;
public:
    RefCount() :　use_count(0) &#123;
    &#125;

    RefCount(const RefCount&amp;) = delete;

    RefCount&amp; operator=(const RefCount&amp;) = delete;

    ~RefCount() &#123;&#125;

    void reset() &#123;
        use_count_ = 0;
    &#125;

    unsigned int use_count() &#123;
        return use_count_;
    &#125;

    // 重载前置/后置自增
    void operator++() &#123;
      ++use_count_;
    &#125;
 
    void operator++(int) &#123;
      use_count_++;
    &#125;
 
    // 重载前置/后置自减
    void operator--() &#123;
      --use_count_;
    &#125;

    void operator--(int) &#123;
      use_count_--;
    &#125;

    // 重载 &lt;&lt; 操作
    friend operator &lt;&lt; (std::ostream&amp; os, const RefCount&amp; RefCount) &#123;
        os &lt;&lt; &quot;当前引用值为: &quot; &lt;&lt; RefCount.use_count_ &lt;&lt; std::endl;
        return os;
    &#125;

private:
    unsigned int use_count_ &#123;&#125;;
    // usinged int weak_count_ &#123;&#125;;
&#125;; 

template &lt;typename T&gt;
class SharedPtr &#123;
    // 显式构造
    explicit SharedPtr(T* ptr = nullptr) &#123;
        raw_ptr_ = ptr;
        ref_count_ = new RefCount();
        if(ptr) &#123;
            (*ref_count_)++;
        &#125;
    &#125;

    // 拷贝构造
    SharedPtr(cconst SharedPtr&amp; sp) &#123;
        raw_ptr_ = sp.raw_ptr_;
        ref_count_ = sp.ref_count_;
        ++(*ref_count_);
    &#125;

    T* get() &#123;
        return raw_ptr_;
    &#125;

    unsigned int use_count() &#123;
        return ref_count_-&gt;use_count();
    &#125;

    ~SharedPtr() &#123;
        --(*ref_count_);
        if(ref_count_-&gt;use_count() == 0) &#123;
            delete ref_count_;
            delete raw_ptr_;
        &#125;
    &#125;

    T&amp; operator*() &#123;
        return *raw_ptr_;
    &#125;

    T* operator-&gt;() &#123;
        return raw_ptr_;
    &#125;

    friend operator &lt;&lt; (std::ostream&amp; os, const SharedPtr&amp; sp) &#123;
        os &lt;&lt; &quot;所指对象地址： &quot; &lt;&lt; sp-&gt;get() &lt;&lt; std::endl;
        os &lt;&lt; &quot;引用计数： &quot; &lt;&lt; (*sp.ref_count_) &lt;&lt; std::endl;
        return os;
    &#125;

private:
    T*              raw_ptr_ = nullptr;
    RefCount*       ref_count_ = nullptr;
&#125;;
</code></pre>
</blockquote>
<br/>

<p><strong>shared_ptr 引用计数</strong></p>
<blockquote>
<pre><code class="cpp">// GCC, c++/9/bits/shared_ptr_base.h
template&lt;typename _Tp, _Lock_policy _Lp&gt;
class __shared_ptr : public __shared_ptr_access&lt;_Tp, _Lp&gt; &#123;
    // ...
    _M_refcount = __shared_count&lt;_Lp&gt;(std::move(__r));
    
   element_type*       _M_ptr;         // Contained pointer.
   __shared_count&lt;_Lp&gt;  _M_refcount;    // Reference counter.
&#125;;

template&lt;_Lock_policy _Lp&gt;
class __shared_count &#123;
    _Sp_counted_base&lt;_Lp&gt;*  _M_pi;

    __shared_count(_Ptr __p) : _M_pi(0) &#123;
        __try &#123;
            _M_pi = new _Sp_counted_ptr&lt;_Ptr, _Lp&gt;(__p);
        &#125;
    &#125;
&#125;；

// Called when _M_use_count drops to zero, to release the resources
// managed by *this.
template&lt;typename _Ptr, _Lock_policy _Lp&gt;
class _Sp_counted_ptr final : public _Sp_counted_base&lt;_Lp&gt; &#123;
    virtual void _M_dispose() noexcept &#123; 
        delete _M_ptr; 
    &#125;

    virtual void _M_destroy() noexcept &#123; 
        delete this; 
    &#125;
&#125;;
    
    
template&lt;_Lock_policy _Lp = __default_lock_policy&gt;
class _Sp_counted_base : public _Mutex_base&lt;_Lp&gt; &#123;
 _Atomic_word  _M_use_count;     // #shared
 _Atomic_word  _M_weak_count;    // #weak + (#shared != 0)
&#125;；
</code></pre>
</blockquote>
<br/>

<p><code>std::shared_ptr 通过 get() 获取原始指针， reset() 减少一个引用计数， get_count()查看一个对象当前的引用计数。 </code></p>
<blockquote>
<pre><code class="c++">// 记录有多少个share_ptr共同指向一个对象
#include &lt;memory&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;

#define LOG(x) std::cout &lt;&lt; x &lt;&lt; std::endl

template &lt;typename T&gt;
void print_use_count(const T&amp; p, std::string name) &#123;
     LOG(name + &quot;.use_count() = &quot; + p.use_count());
&#125;

int main() &#123;

 auto p1 = std::make_shared&lt;int&gt;(100);
 auto p2 = p1;
 auto p3 = p1;
 int *q = p1.get(); // 不会增加引用计数

 auto print_all = [&amp;]() &#123; 
     print_use_count(p1, &quot;p1&quot;);
     print_use_count(p2, &quot;p2&quot;);
     print_use_count(p3, &quot;p3&quot;);
 &#125;;

 print_all();
 LOG(&quot;reset p2 之后:&quot;);
 p2.reset();
 print_all();

 LOG(&quot;reset p3 之后:&quot;);
 p3.reset();
 print_all();

 return 0;
&#125;
</code></pre>
</blockquote>
<blockquote>
<pre><code class="bash">$ ./share_ptr 
p1.use_count() = 3
p2.use_count() = 3
p3.use_count() = 3
reset p2 之后： 
p1.use_count() = 2
p2.use_count() = 0
p3.use_count() = 2
reset p3 之后： 
p1.use_count() = 1
p2.use_count() = 0
p3.use_count() = 0
</code></pre>
</blockquote>
<br/>



<br/>

<h2 id="std-unique-ptr"><a href="#std-unique-ptr" class="headerlink" title="std::unique_ptr"></a><strong>std::unique_ptr</strong></h2><table>
<thead>
<tr>
<th>操作</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>unique_ptr&lt;T, D&gt;u</td>
<td>D 为指定的释放方法用于替代 delete</td>
</tr>
<tr>
<td>u.release()</td>
<td>u 让出 对所持对象的控制权，返回出来，并置 u 为 nullptr</td>
</tr>
<tr>
<td>u.reset()</td>
<td>删除 u 指向对象</td>
</tr>
<tr>
<td>u.reset(q)</td>
<td>如果 q 有效 令 u 指向 q</td>
</tr>
</tbody></table>
<br/>

<p><code>是一种独占指针，禁止其他智能指针与其共享同一个对象，从而保证代码安全。</code></p>
<p><code>独占，意味着，不可复制。但是，我们可以利用 std::move() 移交给其他 unique_ptr。</code></p>
<blockquote>
<pre><code class="c++">#include &lt;memory&gt;
#include &lt;iostream&gt;

int main() &#123;

    std::unique_ptr&lt;int&gt; p1 = std::make_unique&lt;int&gt;(100);

    // auto p2 = p1; // 非法

    // 利用std::move转移独占权
    auto p3 = std::move(p1);
    if (!p1) &#123;
        std::cout &lt;&lt; &quot;p1 移交独占权后，为空！&quot; &lt;&lt; std::endl;
    &#125;
    return 0;
&#125;
</code></pre>
</blockquote>
<blockquote>
<pre><code class="bash">$ ./unique_ptr 
p1移交独占权后，为空！
</code></pre>
</blockquote>
<br/>

<br/>

<h2 id="std-weak-ptr"><a href="#std-weak-ptr" class="headerlink" title="std::weak_ptr"></a><strong>std::weak_ptr</strong></h2><table>
<thead>
<tr>
<th>操作</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>weak_ptr<T> w(sp)</td>
<td>sp 为可以和 T 互转的 shared_ptr</td>
</tr>
<tr>
<td>w.reset()</td>
<td>让 w 为空</td>
</tr>
<tr>
<td>w.expired()</td>
<td>如果 w.use_count() == 0， 返回 <code>true</code></td>
</tr>
<tr>
<td>w.lock()</td>
<td>如果 expired() 为 <code>true</code>,返回 nullptr， 否则返回 w 所指向对象的 shared_ptr</td>
</tr>
</tbody></table>
<br/>

<blockquote>
<pre><code class="cpp">shared_ptr&lt;_Tp&gt; lock() const noexcept &#123; 
    return shared_ptr&lt;_Tp&gt;(*this, std::nothrow); 
&#125;
</code></pre>
</blockquote>
<br/>

<blockquote>
<pre><code class="cpp">if (const auto sp(w.lock()); sp) &#123;
    cout &lt;&lt; &quot;对象不为空&quot;;
&#125; else &#123;
    cout &lt;&lt; &quot;nullptr&quot;；
&#125;
</code></pre>
</blockquote>
<br/>

<p><code>std::weak_ptr 要解决的是 std::shared_ptr存在的强引用带来的的资源无法释放的问题。 </code></p>
<p><code>没有 * 和 -&gt; 运算符，所以不能够对资源进行操作，expired() 在资源未被释放时返回 true。</code></p>
<br/>

<p><strong>循环引用例子</strong></p>
<blockquote>
<pre><code class="cpp">#include &lt;iostream&gt;
#include &lt;memory&gt;
using namespace std;

class B;

class A &#123;
public:
    A() &#123; cout &lt;&lt; &quot;A()&quot; &lt;&lt; endl; &#125;
    ~A() &#123; cout &lt;&lt; &quot;~A()&quot; &lt;&lt; endl; &#125;
    shared_ptr&lt;B&gt; b; // 指向 B 对象的智能指针
&#125;;

class B &#123;
public:
    B() &#123; cout &lt;&lt; &quot;B()&quot; &lt;&lt; endl; &#125;
    ~B() &#123; cout &lt;&lt; &quot;~B()&quot; &lt;&lt; endl; &#125;
    shared_ptr&lt;A&gt; a; // 指向 A 对象的智能指针
&#125;;

int main() &#123;
    shared_ptr&lt;A&gt; ptra(new A());// a 指向 A 对象，A 的引用计数为 1
    shared_ptr&lt;B&gt; ptrb(new B());// b 指向 B 对象，B 的引用计数为 1
    ptra-&gt;b = b;// A 对象的成员变量_ptrb也指向 B 对象，B 的引用计数为 2
    ptrb-&gt;a = a;// B 对象的成员变量_ptra也指向 A 对象，A 的引用计数为 2

    cout &lt;&lt; ptra.use_count() &lt;&lt; endl; // 打印A的引用计数结果:2
    cout &lt;&lt; ptrb.use_count() &lt;&lt; endl; // 打印B的引用计数结果:2

    /*
    离开 main 函数作用域，ptra 和 ptrb 两个局部对象析构，分别给 A 对象和
     B 对象的引用计数从 2 减到 1，达不到释放 A 和 B 的条件（释放的条件是
    A 和 B 的引用计数为 0，因此造成两个new出来的A和B对象无法释放，导致内存泄露
    */
    return 0;
&#125;
</code></pre>
</blockquote>
<p><strong>a 、b 被销毁后，A，B依然被强引用无法释放</strong></p>
<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/C%2B%2B%E6%96%B0%E7%89%B9%E6%80%A7/pointers1_en.png">

<br/>

<p><strong>使用弱引用指针 std::weak_ptr， 不会引起引用计数的增加。</strong></p>
<img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/BlogImages/C%2B%2B%E6%96%B0%E7%89%B9%E6%80%A7/pointers2.png">

<br/>

<p><strong>weak_ptr 是怎么解决 循环引用的问题？</strong></p>
<p>参考知乎链接: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/144593171">源码分析shared_ptr实现</a>。</p>
<p><code>当 use_count() == 0 或者 weak_count() == 0 时，释放资源。</code></p>
<blockquote>
<pre><code class="cpp">//GCC,  c++/9/bits/shared_ptr_base.h
template&lt;typename _Tp, _Lock_policy _Lp&gt;
class __weak_ptr &#123;
 // ...
 __weak_count&lt;_Lp&gt;  _M_refcount;    // Reference counter.
&#125;;

template&lt;_Lock_policy _Lp&gt;
class __weak_count &#123;
 // ... 
 
 _Sp_counted_base&lt;_Lp&gt;*  _M_pi;
&#125;;

// _Sp_counted_base 引用计数对象有 2 种计数
// 1. use_count 统计有多少 shared_ptr 指向资源对象
// 2. weak_count 统计有多少 weak_ptr 指向资源对象
// _M_use_count 和 _M_weak_count 都为 0 时， 才会释放 _Sp_counted_base 的内存
template&lt;_Lock_policy _Lp = __default_lock_policy&gt;
class _Sp_counted_base : public _Mutex_base&lt;_Lp&gt; &#123;
 // ...
 _Atomic_word  _M_use_count;     // #shared
 _Atomic_word  _M_weak_count;    // #weak + (#shared != 0)
    
    
    template&lt;&gt;
    inline void
    _Sp_counted_base&lt;_S_single&gt;::_M_weak_add_ref() noexcept &#123; 
        ++_M_weak_count; 
    &#125;

    template&lt;&gt; inline void
    _Sp_counted_base&lt;_S_single&gt;::_M_weak_release() noexcept &#123;
        if (--_M_weak_count == 0)
            _M_destroy();
    &#125;
    // Called when _M_use_count drops to zero, to release the resources
    // managed by *this.
    virtual void _M_dispose() noexcept = 0;
    
    // Called when _M_weak_count drops to zero.
    virtual void _M_destroy() noexcept &#123; 
        delete this; 
    &#125;
&#125;;

long use_count() const noexcept &#123;
 // Returns: 0 if *this is empty; 
 // otherwise, the number of shared_ptr instances that share ownership
 // with *this.
&#125;

bool expired() const noexcept &#123;
 // Returns: use_count() == 0.
&#125;

shared_ptr&lt;T&gt; lock() const noexcept &#123;
 // Returns: expired() ? shared_ptr&lt;T&gt;() : shared_ptr&lt;T&gt;(*this), executed atomically.
&#125;
</code></pre>
</blockquote>
<br/>

<blockquote>
<pre><code class="cpp">// 解决 std::share_ptr带来的强引用无法释放的问题。

#include &lt;iostream&gt;
#include &lt;memory&gt;

#define LOG(x) std::cout &lt;&lt; x &lt;&lt; std::endl

class A;
class B;

class A &#123;
public:
  std::shared_ptr&lt;B&gt; ptr_b;
  ~A() &#123;
        LOG(&quot;A 被销毁。&quot;);
  &#125;
&#125;;

class B &#123;
public:
  std::shared_ptr&lt;A&gt; ptr_a;
  ~B() &#123;
        LOG(&quot;B 被销毁。&quot;);
  &#125;
&#125;;

void strong_referrence() &#123;
  auto a = std::make_shared&lt;A&gt;();
  auto b = std::make_shared&lt;B&gt;();

  // 存在循环引用
  // use_count() 永远不会等于 0, 不会调用各自的析构函数
  a-&gt;ptr_b = b;
  b-&gt;ptr_a = a;
&#125;

int main() &#123;
  strong_referrence(); // 强引用存在的情况

  std::weak_ptr&lt;int&gt; weak_p;

  // std::weak_ptr 没有 * 运算符 和 -&gt; 运算符，不能够对资源进行操作
  // expired() 方法 用于判断资源是否被释放
  auto observer = [&amp;] () &#123;
        if (auto ptr = weak_p.lock()) &#123;
            LOG(*ptr);
        &#125; else &#123;
            LOG(&quot;资源被释放!&quot;);
        &#125;
  &#125;;

  &#123;
        LOG(&quot;进入某个作用域赋值。&quot;);
        auto p1 = std::make_shared&lt;int&gt;(100);
        weak_p = p1;
        observer();
        LOG(&quot;离开某个作用域。&quot;);
  &#125;

  observer();

  return 0;
&#125;
</code></pre>
</blockquote>
<blockquote>
<pre><code class="bash">$ ./weak_ptr 
进入某个作用域赋值。
100
离开某个作用域。
资源被释放!
</code></pre>
</blockquote>
<br/>

<h2 id="std-enable-shared-from-this"><a href="#std-enable-shared-from-this" class="headerlink" title="std::enable_shared_from_this"></a>std::enable_shared_from_this</h2><ul>
<li><code>shared_from_this()</code> 返回 一个指向 <code>this</code> 的  <code>shared_ptr</code>。</li>
<li><code>weak_from_this()</code> 返回一个指向 <code>this</code> 的 <code>weak_ptr</code>。</li>
<li><code>A class T can inherit from enable_shared_from_this&lt;T&gt; to inherit the shared_from_this member functions that obtain a shared_ptr instance pointing to *this.</code></li>
</ul>
<br/>

<p><strong>要解决的问题</strong></p>
<p>1、当类 A 被 <code>shared_ptr</code> 管理，且在类 A 的成员函数里需要把当前类对象作为参数传给其他函数时，就需要传递一个指向自身的 <code>share_ptr</code>。为了防止智能指针的语义被破坏，不直接传递 <code>this</code> 指针。</p>
<p>2、不直接传递 <code>shared_ptr&lt;this&gt;</code>，因为这样会造成多个非共享的 <code>shared_ptr</code> 指向同一个对象，未增加引用计数导对象被析构多次，如下：</p>
<blockquote>
<pre><code class="cpp">
#include &lt;memory&gt;
#include &lt;iostream&gt;
 
class Bad &#123;
public:
    std::shared_ptr&lt;Bad&gt; getptr() &#123;
        return std::shared_ptr&lt;Bad&gt;(this);
    &#125;
    ~Bad() &#123; std::cout &lt;&lt; &quot;Bad::~Bad() called&quot; &lt;&lt; std::endl; &#125;
&#125;;
 
int main() &#123;
    // 错误点：每个 shared_ptr 都认为自己是对象仅有的所有者
    std::shared_ptr&lt;Bad&gt; bp1(new Bad());
    std::shared_ptr&lt;Bad&gt; bp2 = bp1-&gt;getptr();
    // 打印bp1和bp2的引用计数
    std::cout &lt;&lt; &quot;bp1.use_count() = &quot; &lt;&lt; bp1.use_count() &lt;&lt; std::endl; // 1
    std::cout &lt;&lt; &quot;bp2.use_count() = &quot; &lt;&lt; bp2.use_count() &lt;&lt; std::endl; // 1
&#125;
</code></pre>
</blockquote>
<br/>

<p><strong>使用方式</strong></p>
<blockquote>
<pre><code class="cpp">class MyObject : public std::enable_shared_from_this&lt;MyObject&gt; &#123;
public:
    std::shared_ptr&lt;MyObject&gt; pointer() &#123; return shared_from_this(); &#125;
&#125;;

int main() &#123;
    auto p1 = std::make_shared&lt;MyObject&gt;();
    auto p2 = p1-&gt;pointer();
    auto p3 = p1-&gt;shared_from_this();
    
    MyObject unshared;
    auto p4 = unshared.shared_from_this(); // Throws std::bad_weak_ptr
    return 0;
&#125;
</code></pre>
</blockquote>
<br/>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p><strong>对动态数组使用只能指针</strong></p>
<table>
<thead>
<tr>
<th>unique_ptr&lt;int[]&gt; up(new int[10]);</th>
<th>shared_ptr<int> sp(new int[10], [](int *p) { delete[] p; });</th>
</tr>
</thead>
<tbody><tr>
<td>可以 up[i] 索引访问</td>
<td></td>
</tr>
<tr>
<td>up.release() 会自动使用 delete[] 删除</td>
<td>sp.reset(), 调用自定义的 deleter.</td>
</tr>
</tbody></table>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2021/03/23/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/C++17%20%E6%96%B0%E7%89%B9%E6%80%A7/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2021/03/15/C++%20%E6%96%B0%E7%89%B9%E6%80%A7/%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%88%E4%B8%89%EF%BC%89%E5%AF%B9%E6%A0%87%E5%87%86%E5%BA%93%E7%9A%84%E6%89%A9%E5%85%85/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/me.png" alt="Joy Chen's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        joychenisno1@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="joychenisno1@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2021/06/">六月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/05/">五月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/03/">三月 2021<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/C-%E6%96%B0%E7%89%B9%E6%80%A7/">C++新特性<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/STL/">STL<span class="sidebar_archives-count">4</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;进阶之路
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('
<link rel="stylesheet" href="/css/uc.css">
');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 0000;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        <!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/js/index.js"></script><!-- hexo injector body_end end --></body>
    
</html>
