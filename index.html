<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>JoyChen's 知识星球</title><meta name="keywords" content="C++,Golang"><meta name="author" content="JoyChen"><meta name="copyright" content="JoyChen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="If you haven&#39;t found it yet Keep looking Don&#39;t settle">
<meta property="og:type" content="website">
<meta property="og:title" content="JoyChen&#39;s 知识星球">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="JoyChen&#39;s 知识星球">
<meta property="og:description" content="If you haven&#39;t found it yet Keep looking Don&#39;t settle">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/favicon.png">
<meta property="article:author" content="JoyChen">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JoyChen\'s 知识星球',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2025-03-20 19:26:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">63</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">44</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JoyChen's 知识星球</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">JoyChen's 知识星球</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/JoyChenNo1" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:joychenisno1@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DDD设计模式"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式">DDD设计模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-04-11T14:08:00.000Z" title="发表于 2024-04-11 22:08:00">2024-04-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></span></div><div class="content">Domain-Driven Design (DDD) is a software development philosophy that emphasizes the importance of understanding and modeling the business domain. It is a strategy aimed at improving the quality of software by aligning it more closely with the business needs it serves. DDD was first introduced to the software development community in 2003 by Eric Evans in his book “Domain-Driven Design: Tackling Complexity in the Heart of Software.” The book, which has since become a seminal work in the field, pr ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/01/17/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8818%EF%BC%89%20%E9%99%90%E6%B5%81/" title="Go 并发编程篇（18） 限流"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（18） 限流"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/01/17/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8818%EF%BC%89%20%E9%99%90%E6%B5%81/" title="Go 并发编程篇（18） 限流">Go 并发编程篇（18） 限流</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-01-17T12:08:00.000Z" title="发表于 2024-01-17 20:08:00">2024-01-17</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他 go 并发编程知识学习的汇总，持续完善中。




令牌桶（Token Bucket）限流算法令牌桶算法是网络流量整形和速率限制中最常用的一种算法。
实现思路：
（1）大小固定的令牌桶，以恒定的速率源源不断的产生令牌 token。
（2）如果令牌不被消耗，或者说令牌产生速率 &gt; 令牌被消费的速率，令牌就会不断堆积，直到令牌桶填满。后面产生的令牌会从令牌桶溢出。
（3）对于请求，一个请求消耗一个令牌，可以根据权重设置一个请求所消耗的令牌数量。
（4）当令牌桶中的令牌少于请求的令牌时，不会删除令牌，请求被丢弃或者做其他返回。
可以看出，令牌桶能应对于突发的大量请求，它们都能获得令牌，而后面来的请求能做有效格挡。
使用基于 golang.org/x/time/rate 和 Redis 实现令牌桶算法:
package main

import (
    "context"
    "fmt"
    "strconv"
    "time"

    "github.com/go-redis/redis/v9"
    "gol ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 基础镜像构建示例"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例">Docker 基础镜像构建示例</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-01-14T12:08:00.000Z" title="发表于 2024-01-14 20:08:00">2024-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Docker/">Docker</a></span></div><div class="content">背景服务更新基础镜像.
镜像 DockfileFROM python:3.7

WORKDIR /usr/src/app
COPY ./watermark ./
COPY ./requirements.txt ./

RUN apt-get update &amp;&amp; apt-get install -y vim libgl1-mesa-glx &amp;&amp; \
pip install -r requirements.txt  -i https://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; \
pip uninstall -y PyMuPDF &amp;&amp; \ 
pip install PyMuPDF -i https://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; \
pip uninstall -y opencv-python opencv-contrib-python opencv-python-headless &amp;&amp; \
pip install op ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/01/13/%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95/go-tool%E4%B9%8Bpprof%E7%9A%84%E4%BD%BF%E7%94%A8/" title="go 服务调试之pprof"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="go 服务调试之pprof"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/01/13/%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95/go-tool%E4%B9%8Bpprof%E7%9A%84%E4%BD%BF%E7%94%A8/" title="go 服务调试之pprof">go 服务调试之pprof</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-01-13T12:08:00.000Z" title="发表于 2024-01-13 20:08:00">2024-01-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/golang/debugging/">debugging</a></span></div><div class="content">压测工具 https://github.com/bojand/ghz.git
性能指标
响应时间
平均响应时间：指服务处理请求的平均耗时，反映了服务的整体处理速度。例如，一个 Web 服务处理所有 HTTP 请求的平均时间。
最大响应时间：服务处理请求的最长耗时，能体现服务在极端情况下的性能表现。比如，在高并发场景下某个数据库查询操作的最长响应时间。
P95、P99 响应时间：P95 响应时间表示在所有请求中，95% 的请求响应时间都小于该值；P99 同理。这两个指标更关注长尾请求的性能，对于保障用户体验非常重要。


吞吐量
每秒请求数（QPS）：指服务每秒能够处理的请求数量，体现了服务的处理能力。例如，一个 API 服务每秒能够处理的请求次数。
每秒事务数（TPS）：用于衡量系统在单位时间内处理的事务数量，适用于需要处理多个步骤的业务流程。比如，电商系统中每秒完成的订单交易数量。



可用性指标
服务可用性
正常运行时间百分比：通常用 “X 个 9” 来表示，如 99.9%（三个 9）、99.99%（四个 9）等。例如，服务可用性为 99.9% 表示在一年中，服务不可用的时间不超 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/12/26/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8815%EF%BC%89%20%E5%90%88%E5%B9%B6%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82%20SingleFlight/" title="Go 并发编程篇（15） 并发请求合并利器 SingleFlight"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（15） 并发请求合并利器 SingleFlight"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/26/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8815%EF%BC%89%20%E5%90%88%E5%B9%B6%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82%20SingleFlight/" title="Go 并发编程篇（15） 并发请求合并利器 SingleFlight">Go 并发编程篇（15） 并发请求合并利器 SingleFlight</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-26T13:08:00.000Z" title="发表于 2023-12-26 21:08:00">2023-12-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他 go 并发编程知识学习的汇总，持续完善中。




SingleFlight


sync.Once
SingleFlight











实现go 官方实现
// Copyright 2013 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

// Package singleflight provides a duplicate function call suppression
// mechanism.
package singleflight // import "golang.org/x/sync/singleflight"

import (
  "bytes"
  "errors"
  "fmt"
  "runtime"
  "runtime/debug"
  "sync"
 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/12/25/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8814%EF%BC%89%20%E4%BF%A1%E5%8F%B7%E9%87%8F%20Semaphore/" title="Go 并发编程篇（14）信号量 Semaphore"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（14）信号量 Semaphore"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/25/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8814%EF%BC%89%20%E4%BF%A1%E5%8F%B7%E9%87%8F%20Semaphore/" title="Go 并发编程篇（14）信号量 Semaphore">Go 并发编程篇（14）信号量 Semaphore</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-25T02:08:00.000Z" title="发表于 2023-12-25 10:08:00">2023-12-25</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他go并发编程知识学习的汇总，持续完善中。


Semaphore信号量本质上是一个整数变量，用于表示可用资源的数量。
它支持两种基本操作： 
P 操作（Proberen，荷兰语，意为尝试）：也称为 wait 操作或 acquire 操作。当一个进程或线程需要访问共享资源时，会执行 P 操作。该操作会将信号量的值减 1，如果减 1 后信号量的值大于等于 0，则表示有可用资源，进程或线程可以继续执行；如果减 1 后信号量的值小于 0，则表示没有可用资源，进程或线程会被阻塞，直到有其他进程或线程释放资源。 
V 操作（Verhogen，荷兰语，意为增加）：也称为 signal 操作或 release 操作。当一个进程或线程使用完共享资源后，会执行 V 操作。该操作会将信号量的值加 1，如果加 1 后信号量的值小于等于 0，则表示有其他进程或线程在等待资源，会唤醒一个等待的进程或线程。
工作原理 
信号量的工作原理基于其整数值的变化和对进程或线程的阻塞与唤醒机制。
具体来说： 
1、初始化：在使用信号量之前，需要对其进行初始化，设置初始值。 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/12/24/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8811%EF%BC%89%20channel/" title="Go 并发编程篇（11）channel"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（11）channel"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/24/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8811%EF%BC%89%20channel/" title="Go 并发编程篇（11）channel">Go 并发编程篇（11）channel</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-24T12:08:00.000Z" title="发表于 2023-12-24 20:08:00">2023-12-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他go并发编程知识学习的汇总，持续完善中。


channel使用应用场景：数据传递，信息交流（生产-消费），信号通知，任务编排，互斥锁。
实现https://joychenno1.github.io/2021/11/13/Go/go%E5%9F%BA%E7%A1%80/


使用规则1、避免导致阻塞的情况，避免 goroutine 泄漏：




nil chan
not emtpy chan
empty chan
full buffered chan
not full buffered chan
closed chan



&lt;-chan
block
can read value
block
can read value
can read value
after read the rest of value(s), then return nil


chan&lt;-
block
can write value
can write value
block
can write value
panic


close
pani ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/12/23/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8810%EF%BC%89%20%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C/" title="Go 并发编程篇（10）原子操作"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（10）原子操作"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/23/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8810%EF%BC%89%20%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C/" title="Go 并发编程篇（10）原子操作">Go 并发编程篇（10）原子操作</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-23T12:23:00.000Z" title="发表于 2023-12-23 20:23:00">2023-12-23</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他go并发编程知识学习的汇总，持续完善中。




原子操作多核系统中，由于缓存的存在，单核上的单个指令进行原子操作时，为了确保其他核不访问该原子操作的地址，提供相应指令实现锁机制，例如，x86 (LOCK CMPXCHG op1, op2), ARM (LL&#x2F;SC, Load Link&#x2F;Store Conditional)。为了让一个核执行原子操作后修改的值能及时同步给其他核，一般使用内存屏障（memory barrier）的方式，一个写内存屏障告诉处理器，必须等到写操作被刷到内存中，在进行其他操作。这个操作还会使相关 CPU 缓存失效，以便其他处理器从主存中重新拉取数据。
Go 提供了一个通用的原子操作 API，封装成 sync.atomic。automic 时实现 lock-free 的数据结构的基石。
使用// Package queue provides a lock-free queue and two-Lock concurrent queue which use the algorithm prop ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/12/22/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%889%EF%BC%89Context/" title="Go 并发编程篇（9）Context"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（9）Context"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/22/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%889%EF%BC%89Context/" title="Go 并发编程篇（9）Context">Go 并发编程篇（9）Context</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-22T14:08:00.000Z" title="发表于 2023-12-22 22:08:00">2023-12-22</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他go并发编程知识学习的汇总，持续完善中。


Context实现Context 接口定义type Context interface &#123;
    Deadline() (deadline time.Time, ok bool)
    Done() &lt;-chan struct&#123;&#125;
    Err() error
    Value(key any) any
&#125;



Context Errorvar Canceled = errors.New("context canceled") // context 被 cancel 时会报此错误；


var DeadlineExceeded error = deadlineExceededError&#123;&#125;


type deadlineExceededError struct&#123;&#125;

// context 超时时会报此错误.
func (deadlineExceededError) Error() string ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/12/21/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%888%EF%BC%89sync.Pool/" title="Go 并发编程篇（8）Pool"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（8）Pool"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/21/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%888%EF%BC%89sync.Pool/" title="Go 并发编程篇（8）Pool">Go 并发编程篇（8）Pool</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-21T13:08:00.000Z" title="发表于 2023-12-21 21:08:00">2023-12-21</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他go并发编程知识学习的汇总，持续完善中。


sync.Pool用法package main

import (
    "fmt"
    "io"
    "net/http"
    "sync"
)

// 定义一个全局的 http.Client 池
var httpClientPool = sync.Pool&#123;
    // 当池为空时，使用 New 函数创建新的 http.Client 实例
    // 使用时，一定要指定 New 方法，因为在并发量不大的时候，GC 有可能回收 Pool 中已经创建的对象
    New: func() interface&#123;&#125; &#123;
        return &amp;http.Client&#123;
          Timeout: 5 * time.Second,
        &#125;
    &#125;,
&#125;

func main() &#123;
    // 从池中获取一个 http.Client 实例
   ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/#content-inner">7</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JoyChen</div><div class="author-info__description">If you haven't found it yet Keep looking Don't settle</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">63</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">44</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">17</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/JoyChenNo1"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/JoyChenNo1" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:joychenisno1@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DDD设计模式"/></a><div class="content"><a class="title" href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式">DDD设计模式</a><time datetime="2024-04-11T14:08:00.000Z" title="发表于 2024-04-11 22:08:00">2024-04-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/17/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8818%EF%BC%89%20%E9%99%90%E6%B5%81/" title="Go 并发编程篇（18） 限流"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（18） 限流"/></a><div class="content"><a class="title" href="/2024/01/17/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8818%EF%BC%89%20%E9%99%90%E6%B5%81/" title="Go 并发编程篇（18） 限流">Go 并发编程篇（18） 限流</a><time datetime="2024-01-17T12:08:00.000Z" title="发表于 2024-01-17 20:08:00">2024-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 基础镜像构建示例"/></a><div class="content"><a class="title" href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例">Docker 基础镜像构建示例</a><time datetime="2024-01-14T12:08:00.000Z" title="发表于 2024-01-14 20:08:00">2024-01-14</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C/"><span class="card-category-list-name">C++</span><span class="card-category-list-count">15</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C/C-Network/"><span class="card-category-list-name">C++ Network</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><span class="card-category-list-name">并发编程</span><span class="card-category-list-count">3</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Asio/" style="font-size: 1.1em; color: #999">Asio</a> <a href="/tags/C/" style="font-size: 1.16em; color: #999b9e">C++</a> <a href="/tags/C-Concurrency/" style="font-size: 1.21em; color: #999ea4">C++ Concurrency</a> <a href="/tags/C-Network/" style="font-size: 1.16em; color: #999b9e">C++ Network</a> <a href="/tags/C-Templates/" style="font-size: 1.1em; color: #999">C++ Templates</a> <a href="/tags/C-%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B/" style="font-size: 1.1em; color: #999">C++ 对象模型</a> <a href="/tags/C-%E5%B9%B6%E5%8F%91/" style="font-size: 1.16em; color: #999b9e">C++ 并发</a> <a href="/tags/C-%E8%B0%83%E7%94%A8-Python/" style="font-size: 1.1em; color: #999">C++ 调用 Python</a> <a href="/tags/C-11/" style="font-size: 1.21em; color: #999ea4">C++11</a> <a href="/tags/C-14/" style="font-size: 1.21em; color: #999ea4">C++14</a> <a href="/tags/C-17/" style="font-size: 1.27em; color: #99a0a9">C++17</a> <a href="/tags/C-20/" style="font-size: 1.16em; color: #999b9e">C++20</a> <a href="/tags/CMake/" style="font-size: 1.1em; color: #999">CMake</a> <a href="/tags/Cache/" style="font-size: 1.16em; color: #999b9e">Cache</a> <a href="/tags/Docker/" style="font-size: 1.1em; color: #999">Docker</a> <a href="/tags/Linux/" style="font-size: 1.1em; color: #999">Linux</a> <a href="/tags/Modern-C/" style="font-size: 1.33em; color: #99a2af">Modern C++</a> <a href="/tags/NoSQL/" style="font-size: 1.1em; color: #999">NoSQL</a> <a href="/tags/Python-%E8%B0%83%E7%94%A8-C/" style="font-size: 1.1em; color: #999">Python 调用 C++</a> <a href="/tags/Redis/" style="font-size: 1.16em; color: #999b9e">Redis</a> <a href="/tags/STL/" style="font-size: 1.39em; color: #99a4b4">STL</a> <a href="/tags/etcd/" style="font-size: 1.1em; color: #999">etcd</a> <a href="/tags/gdb/" style="font-size: 1.1em; color: #999">gdb</a> <a href="/tags/gin/" style="font-size: 1.1em; color: #999">gin</a> <a href="/tags/go-mod/" style="font-size: 1.1em; color: #999">go mod</a> <a href="/tags/go-%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95/" style="font-size: 1.1em; color: #999">go 程序调试</a> <a href="/tags/golang/" style="font-size: 1.5em; color: #99a9bf">golang</a> <a href="/tags/golang-%E5%91%BD%E4%BB%A4%E8%A1%8C/" style="font-size: 1.1em; color: #999">golang 命令行</a> <a href="/tags/gorm/" style="font-size: 1.1em; color: #999">gorm</a> <a href="/tags/grpc/" style="font-size: 1.1em; color: #999">grpc</a> <a href="/tags/job/" style="font-size: 1.39em; color: #99a4b4">job</a> <a href="/tags/lldb/" style="font-size: 1.1em; color: #999">lldb</a> <a href="/tags/pprof/" style="font-size: 1.1em; color: #999">pprof</a> <a href="/tags/proto/" style="font-size: 1.1em; color: #999">proto</a> <a href="/tags/pybind11/" style="font-size: 1.1em; color: #999">pybind11</a> <a href="/tags/shell-command/" style="font-size: 1.1em; color: #999">shell command</a> <a href="/tags/%E4%B8%93%E5%88%A9/" style="font-size: 1.16em; color: #999b9e">专利</a> <a href="/tags/%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6/" style="font-size: 1.16em; color: #999b9e">基础组件</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/" style="font-size: 1.21em; color: #999ea4">工程构建</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 1.44em; color: #99a7ba">并发编程</a></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">63</div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2025-03-20T11:26:41.308Z"></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/bg.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By JoyChen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script></div></body></html>