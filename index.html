<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>JoyChen's 知识星球</title><meta name="keywords" content="C++,Golang"><meta name="author" content="JoyChen"><meta name="copyright" content="JoyChen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="If you haven&#39;t found it yet Keep looking Don&#39;t settle">
<meta property="og:type" content="website">
<meta property="og:title" content="JoyChen&#39;s 知识星球">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="JoyChen&#39;s 知识星球">
<meta property="og:description" content="If you haven&#39;t found it yet Keep looking Don&#39;t settle">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/favicon.png">
<meta property="article:author" content="JoyChen">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JoyChen\'s 知识星球',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2025-03-26 09:43:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JoyChen's 知识星球</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">JoyChen's 知识星球</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/JoyChenNo1" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:joychenisno1@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2025/03/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A8%A1%E5%BC%8F/" title="分布式模式"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式模式"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/03/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A8%A1%E5%BC%8F/" title="分布式模式">分布式模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2025-03-11T05:09:00.000Z" title="发表于 2025-03-11 13:09:00">2025-03-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></span></div><div class="content">分布式模式扇入扇出（FanIn, FanOut）模式介绍扇入和扇出是并发编程中常见的两种模式，用于描述数据流动的方式，特别适用于Go语言中的通道 (channel) 和 goroutine 的协作。
扇出是指一个数据源分发到多个消费者的模式。

一个生产者(或多个生产者)生成数据
多个工作 goroutine 从同一个(或不同)通道读取数据并处理
目的是并行处理，提高吞吐量

扇出特点：

多个 goroutine 从同一个通道读取数据
工作负载被分配到多个处理单元
适用于 CPU 密集型或 IO 密集型的并行处理任务

扇入是指多个数据源合并到一个消费者的模式。

多个生产者 goroutine 生成数据
一个 goroutine 从合并后的通道读取所有数据
目的是聚合结果，集中处理

扇入特点：

多个通道的数据被合并到一个通道
需要一个协调机制(通常用 sync.WaitGroup) 来知道所有输入何时完成
适用于收集分散的计算结果

应用场景







数据处理流水线
扇出：将大数据集分片并行处理扇入：收集所有分片的处理结果


微服务调用
扇出：同时调用多个微服务扇入：聚 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95%E4%B9%8B%20Raft%20%E7%AE%97%E6%B3%95/" title="分布式一致性算法之 Raft 算法"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式一致性算法之 Raft 算法"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95%E4%B9%8B%20Raft%20%E7%AE%97%E6%B3%95/" title="分布式一致性算法之 Raft 算法">分布式一致性算法之 Raft 算法</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-12-11T13:28:00.000Z" title="发表于 2024-12-11 21:28:00">2024-12-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></span></div><div class="content">前言Raft 算法是一种易于理解的分布式一致性算法，它将一致性问题分解为选举、日志复制和安全性三个子问题。通过选举出一个领导者，由领导者负责将日志复制到其他节点，保证数据的一致性。Raft 算法在分布式系统中被广泛应用，如 Etcd、Consul 等开源项目都采用了 Raft 算法来实现分布式一致性。
</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95/" title="分布式常见数据分配算法"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式常见数据分配算法"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95/" title="分布式常见数据分配算法">分布式常见数据分配算法</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-12-11T13:28:00.000Z" title="发表于 2024-12-11 21:28:00">2024-12-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></span></div><div class="content">哈希取模算法原理通过对数据的键进行哈希计算，然后将得到的哈希值对缓存节点的数量进行取模运算，所得的结果就是数据应该存储的缓存节点编号。例如，有n个缓存节点，数据键key的哈希值为hash(key)，那么数据将被存储在hash(key) % n对应的节点上。

优点：算法简单直观，计算速度快，能够均匀地将数据分配到各个缓存节点上，在节点数量固定的情况下，能很好地实现负载均衡。
缺点：当缓存节点数量发生变化时，例如增加或减少节点，几乎所有数据的存储位置都会发生变化，导致大量数据需要在节点之间迁移，系统开销较大。

范围划分算法原理将数据的键按照一定的范围进行划分，每个范围对应一个缓存节点。例如，假设数据的键是整数，可将 0 - 1000 范围的数据存储到节点 1，1001 - 2000 范围的数据存储到节点 2，以此类推。

优点：数据的存储位置相对固定，对于按范围访问的数据，能够快速定位到对应的缓存节点，提高查询效率。
缺点：如果数据分布不均匀，容易导致某些节点负载过高，而其他节点负载过低，出现数据倾斜问题。而且在增加或减少节点时，需要重新划分数据范围，数据迁移量也较大。

随机分配算法 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%AE%97%E6%B3%95%E4%B9%8B%20%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" title="分布式存储算法之一致性哈希算法"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a13.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式存储算法之一致性哈希算法"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%AE%97%E6%B3%95%E4%B9%8B%20%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" title="分布式存储算法之一致性哈希算法">分布式存储算法之一致性哈希算法</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-12-11T13:28:00.000Z" title="发表于 2024-12-11 21:28:00">2024-12-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></span></div><div class="content">前言传统哈希算法应用到分布式系统中时，当去除或者增加一个节点时，导致的大量数据需要重新计算 rehash，系统扩展性低下。
因此，一致性哈希算法通过将数据和节点都映射到一个固定的哈希空间中，计算数据的哈希值来确定其存储位置。当节点加入或离开系统时，只会影响到哈希环上相邻的少数节点，从而减少数据的迁移量。
在分布式缓存系统中主要应用于数据分配、缓存节点的动态管理以及负载均衡等方面，如 Memcached、Redis Cluster 等，以提高系统的可扩展性和数据访问的效率。
算法原理哈希环构建创建一个虚拟的哈希环，这个环的范围通常是从 0 到  $2^{32}$  - 1（因为哈希值通常是 32&#x2F;64 位）。它将整个哈希空间组织成一个环形结构，类似于一个钟表的表盘，0 和 $2^{32}$ - 1 是相邻的。


数据和节点映射在分布式缓存系统中，一致性哈希算法为每个缓存节点和数据对象生成 Hash Value，并将它们映射到同一个哈希环上。数据对象会被存储到哈希环上顺时针方向距离其哈希值最近的缓存节点上。这样可以确保数据在缓存节点之间有一个相对固定且可预测的分布方式，方便数据 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/11/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="分布式事务"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式事务"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/11/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="分布式事务">分布式事务</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-11-11T13:28:00.000Z" title="发表于 2024-11-11 21:28:00">2024-11-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></span></div><div class="content">TODO</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DDD设计模式"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/04/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/DDD%E6%80%9D%E6%83%B3%E5%8F%8A%E5%AE%9E%E8%B7%B5/" title="DDD设计模式">DDD设计模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-04-11T14:08:00.000Z" title="发表于 2024-04-11 22:08:00">2024-04-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></span></div><div class="content">Domain-Driven Design (DDD) is a software development philosophy that emphasizes the importance of understanding and modeling the business domain. It is a strategy aimed at improving the quality of software by aligning it more closely with the business needs it serves. DDD was first introduced to the software development community in 2003 by Eric Evans in his book “Domain-Driven Design: Tackling Complexity in the Heart of Software.” The book, which has since become a seminal work in the field, pr ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/01/17/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8818%EF%BC%89%20%E9%99%90%E6%B5%81/" title="Go 并发编程篇（18） 限流"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（18） 限流"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/01/17/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8818%EF%BC%89%20%E9%99%90%E6%B5%81/" title="Go 并发编程篇（18） 限流">Go 并发编程篇（18） 限流</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-01-17T12:08:00.000Z" title="发表于 2024-01-17 20:08:00">2024-01-17</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他 go 并发编程知识学习的汇总，持续完善中。




令牌桶（Token Bucket）限流算法令牌桶算法是网络流量整形和速率限制中最常用的一种算法。
实现思路：
（1）大小固定的令牌桶，以恒定的速率源源不断的产生令牌 token。
（2）如果令牌不被消耗，或者说令牌产生速率 &gt; 令牌被消费的速率，令牌就会不断堆积，直到令牌桶填满。后面产生的令牌会从令牌桶溢出。
（3）对于请求，一个请求消耗一个令牌，可以根据权重设置一个请求所消耗的令牌数量。
（4）当令牌桶中的令牌少于请求的令牌时，不会删除令牌，请求被丢弃或者做其他返回。
可以看出，令牌桶能应对于突发的大量请求，它们都能获得令牌，而后面来的请求能做有效格挡。
使用基于 golang.org/x/time/rate 和 Redis 实现令牌桶算法:
package main

import (
    "context"
    "fmt"
    "strconv"
    "time"

    "github.com/go-redis/redis/v9"
    "gol ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 基础镜像构建示例"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/01/14/%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/Docker%20build/" title="Docker 基础镜像构建示例">Docker 基础镜像构建示例</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-01-14T12:08:00.000Z" title="发表于 2024-01-14 20:08:00">2024-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Docker/">Docker</a></span></div><div class="content">背景服务更新基础镜像.
镜像 DockfileFROM python:3.7

WORKDIR /usr/src/app
COPY ./watermark ./
COPY ./requirements.txt ./

RUN apt-get update &amp;&amp; apt-get install -y vim libgl1-mesa-glx &amp;&amp; \
pip install -r requirements.txt  -i https://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; \
pip uninstall -y PyMuPDF &amp;&amp; \ 
pip install PyMuPDF -i https://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; \
pip uninstall -y opencv-python opencv-contrib-python opencv-python-headless &amp;&amp; \
pip install op ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2023/12/26/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8815%EF%BC%89%20%E5%90%88%E5%B9%B6%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82%20SingleFlight/" title="Go 并发编程篇（15） 并发请求合并利器 SingleFlight"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（15） 并发请求合并利器 SingleFlight"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/26/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8815%EF%BC%89%20%E5%90%88%E5%B9%B6%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82%20SingleFlight/" title="Go 并发编程篇（15） 并发请求合并利器 SingleFlight">Go 并发编程篇（15） 并发请求合并利器 SingleFlight</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-26T13:08:00.000Z" title="发表于 2023-12-26 21:08:00">2023-12-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他 go 并发编程知识学习的汇总，持续完善中。




SingleFlight


sync.Once
SingleFlight











实现go 官方实现
// Copyright 2013 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

// Package singleflight provides a duplicate function call suppression
// mechanism.
package singleflight // import "golang.org/x/sync/singleflight"

import (
  "bytes"
  "errors"
  "fmt"
  "runtime"
  "runtime/debug"
  "sync"
 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/12/25/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8814%EF%BC%89%20%E4%BF%A1%E5%8F%B7%E9%87%8F%20Semaphore/" title="Go 并发编程篇（14）信号量 Semaphore"><img class="post_bg" src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 并发编程篇（14）信号量 Semaphore"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/12/25/Go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%AF%87%EF%BC%8814%EF%BC%89%20%E4%BF%A1%E5%8F%B7%E9%87%8F%20Semaphore/" title="Go 并发编程篇（14）信号量 Semaphore">Go 并发编程篇（14）信号量 Semaphore</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-25T02:08:00.000Z" title="发表于 2023-12-25 10:08:00">2023-12-25</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/golang/">golang</a></span></div><div class="content">前言鸟窝的《深入理解 Go 并发编程》读书笔记以及其他go并发编程知识学习的汇总，持续完善中。


Semaphore信号量本质上是一个整数变量，用于表示可用资源的数量。
它支持两种基本操作： 
P 操作（Proberen，荷兰语，意为尝试）：也称为 wait 操作或 acquire 操作。当一个进程或线程需要访问共享资源时，会执行 P 操作。该操作会将信号量的值减 1，如果减 1 后信号量的值大于等于 0，则表示有可用资源，进程或线程可以继续执行；如果减 1 后信号量的值小于 0，则表示没有可用资源，进程或线程会被阻塞，直到有其他进程或线程释放资源。 
V 操作（Verhogen，荷兰语，意为增加）：也称为 signal 操作或 release 操作。当一个进程或线程使用完共享资源后，会执行 V 操作。该操作会将信号量的值加 1，如果加 1 后信号量的值小于等于 0，则表示有其他进程或线程在等待资源，会唤醒一个等待的进程或线程。
工作原理 
信号量的工作原理基于其整数值的变化和对进程或线程的阻塞与唤醒机制。
具体来说： 
1、初始化：在使用信号量之前，需要对其进行初始化，设置初始值。 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">JoyChen</div><div class="author-info__description">If you haven't found it yet Keep looking Don't settle</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">53</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/JoyChenNo1"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/JoyChenNo1" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:joychenisno1@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/03/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A8%A1%E5%BC%8F/" title="分布式模式"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/material-8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式模式"/></a><div class="content"><a class="title" href="/2025/03/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A8%A1%E5%BC%8F/" title="分布式模式">分布式模式</a><time datetime="2025-03-11T05:09:00.000Z" title="发表于 2025-03-11 13:09:00">2025-03-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95%E4%B9%8B%20Raft%20%E7%AE%97%E6%B3%95/" title="分布式一致性算法之 Raft 算法"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式一致性算法之 Raft 算法"/></a><div class="content"><a class="title" href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95%E4%B9%8B%20Raft%20%E7%AE%97%E6%B3%95/" title="分布式一致性算法之 Raft 算法">分布式一致性算法之 Raft 算法</a><time datetime="2024-12-11T13:28:00.000Z" title="发表于 2024-12-11 21:28:00">2024-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95/" title="分布式常见数据分配算法"><img src="https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/random/a/a11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式常见数据分配算法"/></a><div class="content"><a class="title" href="/2024/12/11/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E5%88%86%E9%85%8D%E7%AE%97%E6%B3%95/" title="分布式常见数据分配算法">分布式常见数据分配算法</a><time datetime="2024-12-11T13:28:00.000Z" title="发表于 2024-12-11 21:28:00">2024-12-11</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C/"><span class="card-category-list-name">C++</span><span class="card-category-list-count">19</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C/C-Network/"><span class="card-category-list-name">C++ Network</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C/debugging/"><span class="card-category-list-name">debugging</span><span class="card-category-list-count">4</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Asio/" style="font-size: 1.1em; color: #999">Asio</a> <a href="/tags/C/" style="font-size: 1.17em; color: #999c9f">C++</a> <a href="/tags/C-Concurrency/" style="font-size: 1.23em; color: #999ea6">C++ Concurrency</a> <a href="/tags/C-Network/" style="font-size: 1.17em; color: #999c9f">C++ Network</a> <a href="/tags/C-Templates/" style="font-size: 1.1em; color: #999">C++ Templates</a> <a href="/tags/C-%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B/" style="font-size: 1.1em; color: #999">C++ 对象模型</a> <a href="/tags/C-%E5%B9%B6%E5%8F%91/" style="font-size: 1.17em; color: #999c9f">C++ 并发</a> <a href="/tags/C-%E8%B0%83%E7%94%A8-Python/" style="font-size: 1.1em; color: #999">C++ 调用 Python</a> <a href="/tags/C-%E8%B0%83%E8%AF%95/" style="font-size: 1.23em; color: #999ea6">C++ 调试</a> <a href="/tags/C-11/" style="font-size: 1.23em; color: #999ea6">C++11</a> <a href="/tags/C-14/" style="font-size: 1.23em; color: #999ea6">C++14</a> <a href="/tags/C-17/" style="font-size: 1.3em; color: #99a1ac">C++17</a> <a href="/tags/C-20/" style="font-size: 1.17em; color: #999c9f">C++20</a> <a href="/tags/CMake/" style="font-size: 1.1em; color: #999">CMake</a> <a href="/tags/Cache/" style="font-size: 1.17em; color: #999c9f">Cache</a> <a href="/tags/Docker/" style="font-size: 1.1em; color: #999">Docker</a> <a href="/tags/GO-%E8%B0%83%E8%AF%95/" style="font-size: 1.1em; color: #999">GO 调试</a> <a href="/tags/GORM/" style="font-size: 1.1em; color: #999">GORM</a> <a href="/tags/Gin/" style="font-size: 1.1em; color: #999">Gin</a> <a href="/tags/Go/" style="font-size: 1.1em; color: #999">Go</a> <a href="/tags/Go-%E8%B0%83%E8%AF%95/" style="font-size: 1.1em; color: #999">Go 调试</a> <a href="/tags/Kafka/" style="font-size: 1.1em; color: #999">Kafka</a> <a href="/tags/Linux/" style="font-size: 1.1em; color: #999">Linux</a> <a href="/tags/Modern-C/" style="font-size: 1.37em; color: #99a4b2">Modern C++</a> <a href="/tags/Nginx/" style="font-size: 1.1em; color: #999">Nginx</a> <a href="/tags/NoSQL/" style="font-size: 1.1em; color: #999">NoSQL</a> <a href="/tags/Python-%E8%B0%83%E7%94%A8-C/" style="font-size: 1.1em; color: #999">Python 调用 C++</a> <a href="/tags/Redis/" style="font-size: 1.17em; color: #999c9f">Redis</a> <a href="/tags/RocketMQ/" style="font-size: 1.1em; color: #999">RocketMQ</a> <a href="/tags/STL/" style="font-size: 1.43em; color: #99a6b9">STL</a> <a href="/tags/etcd/" style="font-size: 1.17em; color: #999c9f">etcd</a> <a href="/tags/gdb/" style="font-size: 1.1em; color: #999">gdb</a> <a href="/tags/go-mod/" style="font-size: 1.1em; color: #999">go mod</a> <a href="/tags/golang/" style="font-size: 1.5em; color: #99a9bf">golang</a> <a href="/tags/golang-%E5%91%BD%E4%BB%A4%E8%A1%8C/" style="font-size: 1.1em; color: #999">golang 命令行</a> <a href="/tags/grpc/" style="font-size: 1.1em; color: #999">grpc</a> <a href="/tags/job/" style="font-size: 1.43em; color: #99a6b9">job</a> <a href="/tags/lldb/" style="font-size: 1.1em; color: #999">lldb</a> <a href="/tags/pprof/" style="font-size: 1.17em; color: #999c9f">pprof</a> <a href="/tags/proto/" style="font-size: 1.1em; color: #999">proto</a></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">75</div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2025-03-26T01:43:28.499Z"></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://github.com/JoyChenNo1/JoyChenNo1.github.io/raw/master/img/bg.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By JoyChen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script></div></body></html>